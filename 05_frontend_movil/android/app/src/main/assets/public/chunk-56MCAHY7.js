import{a as ne}from"./chunk-OVZYRGGJ.js";import{a as oe}from"./chunk-QCLI6S55.js";import{a as ie}from"./chunk-DUFSMT6L.js";import{a as G,b as Q,c as J,d as z,f as H,g as W,i as U,j as K,k as X,l as Y,m as Z,q as ee,r as te,s as re}from"./chunk-AG2IGI7A.js";import"./chunk-NMI43S2G.js";import{d as L,e as R,h as B}from"./chunk-UFL7QPX4.js";import"./chunk-7IYL6UTE.js";import{l as A,m as q,q as j}from"./chunk-JQOZS3TN.js";import{Aa as l,Bb as n,Cb as u,Db as M,Eb as k,Gb as D,Hb as V,Ib as $,Na as F,Nb as h,Ob as b,Qa as P,R as y,Sa as g,Z as f,Za as m,_ as x,_a as N,gb as o,hb as i,ib as v,mb as _,pb as p,qb as c,tb as O,xa as T}from"./chunk-CFQE6O6P.js";import{a as w,b as E}from"./chunk-4X36HX5K.js";var S=class a{transform(t,e="COP"){if(t==null)return"";let r=typeof t=="string"?parseFloat(t):t;return isNaN(r)?"":new Intl.NumberFormat("es-CO",{style:"currency",currency:e,minimumFractionDigits:0,maximumFractionDigits:0}).format(r)}static \u0275fac=function(e){return new(e||a)};static \u0275pipe=P({name:"copCurrency",type:a,pure:!0})};function le(a,t){a&1&&(o(0,"span",47),n(1,"- PEDIDO ACTIVO"),i())}function se(a,t){if(a&1&&(o(0,"option",45),n(1),g(2,le,2,0,"span",46),i()),a&2){let e=t.$implicit,r=c();N("text-gray-500",r.hasActiveOrderForTable(e.mesa_id.toString())),m("value",e.mesa_id)("disabled",r.hasActiveOrderForTable(e.mesa_id.toString())),l(),k(" Mesa ",e.numero," (",e.estado,") "),l(),m("ngIf",r.hasActiveOrderForTable(e.mesa_id.toString()))}}function de(a,t){if(a&1){let e=_();o(0,"button",48),p("click",function(){let s=f(e).$implicit,d=c();return x(d.selectCategory(s))}),n(1),i()}if(a&2){let e=t.$implicit,r=c();N("bg-orange-500",r.selectedCategory===e)("text-white",r.selectedCategory===e)("bg-gray-700",r.selectedCategory!==e)("text-gray-300",r.selectedCategory!==e),l(),M(" ",e," ")}}function me(a,t){if(a&1&&v(0,"img",61),a&2){let e=c().$implicit;O("alt",e.nombre),m("src",e.imagen_url,T)}}function pe(a,t){a&1&&(o(0,"div",62)(1,"span",63),n(2,"\u{1F37D}\uFE0F"),i()())}function ce(a,t){if(a&1){let e=_();o(0,"div",49)(1,"div",50),g(2,me,1,2,"img",51)(3,pe,3,0,"div",52),i(),o(4,"div",53)(5,"div",54)(6,"h3",55),n(7),i(),o(8,"span",56),n(9),h(10,"copCurrency"),i()(),o(11,"p",57),n(12),i(),o(13,"div",58)(14,"input",59),p("input",function(s){let d=f(e).$implicit,C=c();return x(C.onQtyChange(d.plato_id,s))}),i(),o(15,"button",60),p("click",function(){let s=f(e).$implicit,d=c();return x(d.addItem(s,d.quantities.get(s.plato_id)||1))}),n(16," Agregar "),i()()()()}if(a&2){let e=t.$implicit,r=c();l(2),m("ngIf",e.imagen_url),l(),m("ngIf",!e.imagen_url),l(4),u(e.nombre),l(2),u(b(10,6,e.precio)),l(3),u(e.descripcion),l(2),m("value",r.quantities.get(e.plato_id)||1)}}function ue(a,t){a&1&&(o(0,"tr")(1,"td",64),n(2,"No hay art\xEDculos en el pedido"),i()())}function ge(a,t){if(a&1){let e=_();o(0,"tr")(1,"td",65),n(2),i(),o(3,"td",66)(4,"input",67),p("change",function(s){let d=f(e).$implicit,C=c();return x(C.onQtyChangeOrder(d.id,s))}),i()(),o(5,"td",66),n(6),h(7,"copCurrency"),i(),o(8,"td",66)(9,"button",68),p("click",function(){let s=f(e).$implicit,d=c();return x(d.removeItem(s.id))}),n(10," Eliminar "),i()()()}if(a&2){let e=t.$implicit;l(2),u(e.nombre),l(2),m("value",e.qty),l(2),u(b(7,3,e.precio*e.qty))}}var I=class a{fb=y(ee);platosService=y(ie);mesasService=y(ne);router=y(L);menu=[];filteredMenu=[];mesas=[];order={mesa:0,cliente:"",notas:"",items:[],subtotal:0,tax:0,total:0};searchTerm="";quantities=new Map;form=this.fb.group({mesa:[null,Q.required],cliente:[""],notas:[""]});categories=[];selectedCategory="Todos";ngOnInit(){this.loadMenu(),this.loadMesas(),this.loadDraft()}loadMenu(){this.platosService.getAll().subscribe({next:t=>{this.menu=t.filter(e=>e.disponible),this.extractCategories(),this.filterMenu(),this.menu.forEach(e=>this.quantities.set(e.plato_id,1))},error:t=>console.error("Error loading menu:",t)})}extractCategories(){let t=new Set(this.menu.map(e=>e.categoria).filter(e=>!!e));this.categories=["Todos",...Array.from(t)]}selectCategory(t){this.selectedCategory=t,this.filterMenu()}filterMenu(){let t=this.menu;this.selectedCategory!=="Todos"&&(t=t.filter(e=>e.categoria===this.selectedCategory)),this.searchTerm.trim()&&(t=t.filter(e=>(e.nombre+" "+(e.descripcion||"")).toLowerCase().includes(this.searchTerm.toLowerCase()))),this.filteredMenu=t}loadMesas(){this.mesasService.getAll().subscribe({next:t=>{this.mesas=t},error:t=>console.error("Error loading mesas:",t)})}onSearch(){this.filterMenu()}addItem(t,e=1){let r=this.order.items.find(s=>s.id===t.plato_id);r?r.qty+=e:this.order.items.push({id:t.plato_id,nombre:t.nombre,precio:t.precio,qty:e}),this.updateTotals(),this.saveDraft()}removeItem(t){this.order.items=this.order.items.filter(e=>e.id!==t),this.updateTotals(),this.saveDraft()}changeQty(t,e){let r=this.order.items.find(s=>s.id===t);r&&(r.qty=Math.max(1,e),this.updateTotals(),this.saveDraft())}updateTotals(){this.order.subtotal=this.order.items.reduce((t,e)=>t+e.precio*e.qty,0),this.order.tax=this.order.subtotal*.1,this.order.total=this.order.subtotal+this.order.tax}saveDraft(){let t=E(w({},this.form.value),{items:this.order.items,subtotal:this.order.subtotal,tax:this.order.tax,total:this.order.total});localStorage.setItem("draftOrder",JSON.stringify(t))}loadDraft(){let t=localStorage.getItem("draftOrder");if(t){let e=JSON.parse(t);this.form.patchValue({mesa:e.mesa||"",cliente:e.cliente||"",notas:e.notas||""}),this.order.items=e.items||[],this.updateTotals()}}clearDraft(){confirm("\xBFLimpiar el pedido actual?")&&(this.order.items=[],this.form.reset(),localStorage.removeItem("draftOrder"),this.updateTotals())}onQtyChange(t,e){let r=e.target.value;this.quantities.set(t,+r)}onQtyChangeOrder(t,e){let r=e.target.value;this.changeQty(t,+r)}printReceipt(){if(!this.order.items.length){alert("No hay items en el pedido.");return}let t=new oe;t.setFontSize(20),t.text("Comprobante de Pago",20,20),t.setFontSize(12),t.text(`Mesa: ${this.form.value.mesa}`,20,40),t.text(`Cliente: ${this.form.value.cliente||"N/A"}`,20,50),t.text(`Fecha: ${new Date().toLocaleString()}`,20,60);let e=80;t.text("Items:",20,e),e+=10,this.order.items.forEach(r=>{t.text(`${r.nombre} x${r.qty} - $${(r.precio*r.qty).toFixed(2)}`,20,e),e+=10}),e+=10,t.text(`Subtotal: $${this.order.subtotal.toFixed(2)}`,20,e),e+=10,t.text(`Impuesto (10%): $${this.order.tax.toFixed(2)}`,20,e),e+=10,t.text(`Total: $${this.order.total.toFixed(2)}`,20,e),t.save("comprobante.pdf")}hasActiveOrderForTable(t){return JSON.parse(localStorage.getItem("pedidos")||"[]").some(r=>r.mesa===t&&r.estado!=="Completado"&&r.estado!=="Cancelado")}registerOrder(){if(this.form.invalid){alert("Selecciona una mesa.");return}if(!this.order.items.length){alert("Agrega al menos un platillo.");return}if(this.hasActiveOrderForTable(this.form.value.mesa)){alert("Esta mesa ya tiene un pedido activo. No se pueden crear pedidos duplicados.");return}let t=JSON.parse(localStorage.getItem("pedidos")||"[]"),e="P"+String(Date.now()).slice(-6),r=E(w({id:e},this.form.value),{items:this.order.items,subtotal:this.order.subtotal,tax:this.order.tax,total:this.order.total,estado:"Recibido",fecha:new Date().toISOString()});t.push(r),localStorage.setItem("pedidos",JSON.stringify(t)),localStorage.removeItem("draftOrder"),alert("Pedido registrado: "+e),this.router.navigate(["/waiter/pedidos"])}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=F({type:a,selectors:[["app-nuevo-pedido"]],decls:87,vars:16,consts:[[1,"bg-gray-900","text-gray-100","min-h-screen","flex","flex-col"],[1,"bg-gray-800","shadow"],[1,"max-w-6xl","mx-auto","px-6","py-4","flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-orange-400"],[1,"flex-1","max-w-6xl","mx-auto","px-6","py-8"],[1,"grid","lg:grid-cols-3","gap-6"],[1,"lg:col-span-1","bg-gray-800","p-6","rounded-xl","shadow"],[1,"text-lg","font-semibold","text-gray-200","mb-4"],[3,"formGroup"],[1,"block","text-sm","text-gray-300","mb-1"],["formControlName","mesa",1,"w-full","bg-gray-900","border","border-gray-700","rounded","px-3","py-2","mb-4"],["value",""],[3,"value","disabled","text-gray-500",4,"ngFor","ngForOf"],["formControlName","cliente","type","text","placeholder","Nombre del cliente",1,"w-full","bg-gray-900","border","border-gray-700","rounded","px-3","py-2","mb-4"],["formControlName","notas","rows","4","placeholder","Ej. Sin picante, poco sal...",1,"w-full","bg-gray-900","border","border-gray-700","rounded","px-3","py-2","mb-4"],[1,"w-full","bg-blue-600","hover:bg-blue-700","px-4","py-2","rounded","mb-2","transition",3,"click"],[1,"w-full","bg-red-600","hover:bg-red-700","px-4","py-2","rounded","transition",3,"click"],[1,"lg:col-span-1","bg-gray-800","p-6","rounded-xl","shadow","overflow-hidden","flex","flex-col","h-[calc(100vh-8rem)]"],[1,"flex","flex-col","gap-4","mb-4"],[1,"flex","items-center","justify-between"],[1,"text-lg","font-semibold","text-gray-200"],["type","search","placeholder","Buscar platillo...",1,"bg-gray-900","border","border-gray-700","rounded","px-3","py-2","text-sm","w-48","focus:w-64","transition-all",3,"ngModelChange","input","ngModel"],[1,"flex","gap-2","overflow-x-auto","pb-2","scrollbar-thin","scrollbar-thumb-gray-600","scrollbar-track-gray-800"],["class","px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap hover:bg-orange-600 hover:text-white transition-colors",3,"bg-orange-500","text-white","bg-gray-700","text-gray-300","click",4,"ngFor","ngForOf"],[1,"space-y-4","overflow-y-auto","pr-2","custom-scrollbar","flex-1"],["class","bg-gradient-to-r from-gray-700/70 to-gray-800/70 border border-gray-600 p-4 rounded-2xl shadow-lg hover:shadow-2xl hover:border-orange-500/50 transition-all duration-300 group overflow-hidden flex items-center gap-4 transform hover:scale-102",4,"ngFor","ngForOf"],[1,"lg:col-span-1","bg-gray-800","p-6","rounded-xl","shadow","flex","flex-col"],[1,"flex-1","overflow-auto"],[1,"w-full","text-sm","text-gray-300"],[1,"text-gray-400"],[1,"text-left","py-2"],[1,"text-right","py-2"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"mt-4","border-t","border-gray-700","pt-4"],[1,"flex","justify-between","text-gray-300","mb-2"],[1,"flex","justify-between","text-gray-300","mb-4"],[1,"flex","justify-between","text-orange-400","text-lg","font-bold","mb-4"],[1,"flex","gap-3","mb-4"],[1,"flex-1","bg-blue-500","hover:bg-blue-600","px-4","py-2","rounded","transition",3,"click"],[1,"flex","gap-3"],[1,"flex-1","bg-orange-500","hover:bg-orange-600","px-4","py-2","rounded","transition","transform","hover:scale-105",3,"click"],["routerLink","/waiter/pedidos",1,"flex-1","text-center","bg-gray-700","hover:bg-gray-600","px-4","py-2","rounded","transition"],[1,"bg-gray-800","py-4"],[1,"max-w-6xl","mx-auto","px-6","flex","justify-between","items-center","text-sm","text-gray-400"],[3,"value","disabled"],["class","text-red-400",4,"ngIf"],[1,"text-red-400"],[1,"px-4","py-1.5","rounded-full","text-sm","font-medium","whitespace-nowrap","hover:bg-orange-600","hover:text-white","transition-colors",3,"click"],[1,"bg-gradient-to-r","from-gray-700/70","to-gray-800/70","border","border-gray-600","p-4","rounded-2xl","shadow-lg","hover:shadow-2xl","hover:border-orange-500/50","transition-all","duration-300","group","overflow-hidden","flex","items-center","gap-4","transform","hover:scale-102"],[1,"w-20","h-20","bg-gray-800","rounded-xl","relative","overflow-hidden","flex-shrink-0"],["class","w-full h-full object-cover transition-transform duration-300 group-hover:scale-110","onerror","this.style.display='none'",3,"src","alt",4,"ngIf"],["class","w-full h-full flex items-center justify-center text-gray-600",4,"ngIf"],[1,"flex-1","min-w-0"],[1,"flex","items-start","justify-between","mb-2"],[1,"font-bold","text-gray-100","text-lg","leading-tight","truncate"],[1,"font-bold","text-orange-400","text-lg","ml-2","flex-shrink-0"],[1,"text-sm","text-gray-400","mb-3","line-clamp-2"],[1,"flex","items-center","gap-3"],["type","number","min","1",1,"w-16","bg-gray-900","border","border-gray-600","rounded-lg","px-2","py-1.5","text-center","text-sm","text-gray-200","focus:border-orange-500","focus:outline-none",3,"input","value"],[1,"bg-orange-500","hover:bg-orange-600","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition","active:scale-95","flex-1",3,"click"],["onerror","this.style.display='none'",1,"w-full","h-full","object-cover","transition-transform","duration-300","group-hover:scale-110",3,"src","alt"],[1,"w-full","h-full","flex","items-center","justify-center","text-gray-600"],[1,"text-2xl"],["colspan","4",1,"py-4","px-2","text-gray-400"],[1,"py-2","px-2"],[1,"py-2","px-2","text-right"],["type","number","min","1",1,"qtyField","w-14","bg-gray-900","border","border-gray-700","rounded","px-2","py-1","text-right","text-sm",3,"change","value"],[1,"bg-red-600","hover:bg-red-700","px-2","py-1","rounded","text-sm",3,"click"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"header",1)(2,"div",2)(3,"h1",3),n(4,"\u2795 Nuevo Pedido"),i()()(),o(5,"main",4)(6,"div",5)(7,"section",6)(8,"h2",7),n(9,"Informaci\xF3n"),i(),o(10,"form",8)(11,"label",9),n(12,"Mesa"),i(),o(13,"select",10)(14,"option",11),n(15,"-- Selecciona mesa --"),i(),g(16,se,3,7,"option",12),i(),o(17,"label",9),n(18,"Cliente (opcional)"),i(),v(19,"input",13),o(20,"label",9),n(21,"Notas"),i(),v(22,"textarea",14),i(),o(23,"button",15),p("click",function(){return r.saveDraft()}),n(24," Guardar borrador "),i(),o(25,"button",16),p("click",function(){return r.clearDraft()}),n(26," Limpiar "),i()(),o(27,"section",17)(28,"div",18)(29,"div",19)(30,"h2",20),n(31,"Men\xFA"),i(),o(32,"input",21),$("ngModelChange",function(d){return V(r.searchTerm,d)||(r.searchTerm=d),d}),p("input",function(){return r.onSearch()}),i()(),o(33,"div",22),g(34,de,2,9,"button",23),i()(),o(35,"div",24),g(36,ce,17,8,"div",25),i()(),o(37,"aside",26)(38,"h2",7),n(39,"Resumen del pedido"),i(),o(40,"div",27)(41,"table",28)(42,"thead",29)(43,"tr")(44,"th",30),n(45,"Item"),i(),o(46,"th",31),n(47,"Cant"),i(),o(48,"th",31),n(49,"Subtotal"),i(),v(50,"th"),i()(),o(51,"tbody"),g(52,ue,3,0,"tr",32)(53,ge,11,5,"tr",33),i()()(),o(54,"div",34)(55,"div",35)(56,"span"),n(57,"Subtotal"),i(),o(58,"span"),n(59),h(60,"copCurrency"),i()(),o(61,"div",36)(62,"span"),n(63,"Impuesto (10%)"),i(),o(64,"span"),n(65),h(66,"copCurrency"),i()(),o(67,"div",37)(68,"span"),n(69,"Total"),i(),o(70,"span"),n(71),h(72,"copCurrency"),i()(),o(73,"div",38)(74,"button",39),p("click",function(){return r.printReceipt()}),n(75," Imprimir Comprobante "),i()(),o(76,"div",40)(77,"button",41),p("click",function(){return r.registerOrder()}),n(78," Registrar Pedido "),i(),o(79,"a",42),n(80," Volver "),i()()()()()(),o(81,"footer",43)(82,"div",44)(83,"span"),n(84,"\xA9 2025 RestauSync"),i(),o(85,"span"),n(86,"Hecho con \u2764\uFE0F y TailwindCSS"),i()()()()),e&2&&(l(10),m("formGroup",r.form),l(6),m("ngForOf",r.mesas),l(16),D("ngModel",r.searchTerm),l(2),m("ngForOf",r.categories),l(2),m("ngForOf",r.filteredMenu),l(16),m("ngIf",!r.order.items.length),l(),m("ngForOf",r.order.items),l(6),u(b(60,10,r.order.subtotal)),l(6),u(b(66,12,r.order.tax)),l(6),u(b(72,14,r.order.total)))},dependencies:[j,A,q,re,W,Y,Z,G,X,J,z,U,K,te,H,B,R,S],encapsulation:2})},De=I;export{I as NuevoPedidoComponent,De as default};
