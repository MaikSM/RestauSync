import{a as z}from"./chunk-TZQFGA7U.js";import{a as M,b as c,c as D,d as w,g as k,h as q,i as I,j as O,k as V,l as $,m as G,n as j,o as B,q as H,s as L}from"./chunk-AG2IGI7A.js";import"./chunk-NMI43S2G.js";import{d as N}from"./chunk-UFL7QPX4.js";import"./chunk-7IYL6UTE.js";import{q as T}from"./chunk-JQOZS3TN.js";import{Aa as o,Bb as a,Cb as A,Db as f,Na as E,R as _,Sa as m,Wb as P,Za as p,bb as d,eb as R,fb as S,gb as l,hb as i,ib as g,pb as y,qb as v}from"./chunk-CFQE6O6P.js";import"./chunk-4X36HX5K.js";var J=(e,t)=>t.id+"-"+t.numero,K=(e,t)=>t.value;function Q(e,t){if(e&1&&(l(0,"div",8),a(1),i()),e&2){let r=v();o(),f(" \u26A0\uFE0F ",r.errorMessage," ")}}function U(e,t){if(e&1&&a(0),e&2){let r=v().$implicit;f(" (",r.capacidad," personas) ")}}function W(e,t){if(e&1&&a(0),e&2){let r=v().$implicit;f(" - ",r.ubicacion," ")}}function X(e,t){if(e&1&&(l(0,"option",12),a(1),m(2,U,1,1)(3,W,1,1),i()),e&2){let r=t.$implicit;p("value",r.id),o(),f(" Mesa ",r.numero," "),o(),d(r.capacidad?2:-1),o(),d(r.ubicacion?3:-1)}}function Y(e,t){e&1&&(l(0,"div",13),a(1," Debe seleccionar una mesa "),i())}function Z(e,t){e&1&&a(0," El nombre del cliente es requerido ")}function ee(e,t){e&1&&a(0," El nombre debe tener al menos 2 caracteres ")}function te(e,t){if(e&1&&(l(0,"div",13),m(1,Z,1,0)(2,ee,1,0),i()),e&2){let r,n,s=v();o(),d(!((r=s.createForm.get("cliente_nombre"))==null||r.errors==null)&&r.errors.required?1:-1),o(),d(!((n=s.createForm.get("cliente_nombre"))==null||n.errors==null)&&n.errors.minlength?2:-1)}}function ne(e,t){e&1&&a(0," Ingrese un n\xFAmero de tel\xE9fono v\xE1lido ")}function re(e,t){if(e&1&&(l(0,"div",13),m(1,ne,1,0),i()),e&2){let r,n=v();o(),d(!((r=n.createForm.get("cliente_telefono"))==null||r.errors==null)&&r.errors.pattern?1:-1)}}function ie(e,t){e&1&&(l(0,"div",13),a(1," La fecha y hora de reserva son requeridas "),i())}function ae(e,t){e&1&&a(0," El n\xFAmero de personas es requerido ")}function oe(e,t){e&1&&a(0," Debe ser al menos 1 persona ")}function le(e,t){e&1&&a(0," No puede ser m\xE1s de 20 personas ")}function se(e,t){if(e&1&&(l(0,"div",13),m(1,ae,1,0)(2,oe,1,0)(3,le,1,0),i()),e&2){let r,n,s,u=v();o(),d(!((r=u.createForm.get("numero_personas"))==null||r.errors==null)&&r.errors.required?1:-1),o(),d(!((n=u.createForm.get("numero_personas"))==null||n.errors==null)&&n.errors.min?2:-1),o(),d(!((s=u.createForm.get("numero_personas"))==null||s.errors==null)&&s.errors.max?3:-1)}}function de(e,t){if(e&1&&(l(0,"option",12),a(1),i()),e&2){let r=t.$implicit;p("value",r.value),o(),A(r.label)}}function me(e,t){e&1&&(l(0,"div",13),a(1," El estado es requerido "),i())}function ce(e,t){e&1&&(g(0,"span",23),a(1," Creando... "))}function ue(e,t){e&1&&a(0," \u2795 Crear Reserva ")}var F=class e{_router=_(N);_fb=_(H);_reservasService=_(z);_cdr=_(P);createForm;isSaving=!1;errorMessage="";mesas=[];_reloadSubscription;estadoOptions=[{value:"pendiente",label:"Pendiente"},{value:"confirmado",label:"Confirmado"},{value:"cancelada",label:"Cancelada"},{value:"completada",label:"Completada"}];ngOnInit(){this.createForm=this._fb.group({mesa_id:[null,c.required],cliente_nombre:["",[c.required,c.minLength(2)]],cliente_telefono:["",[c.pattern(/^[\d\-+()\s]+$/)]],fecha_hora:["",c.required],numero_personas:[null,[c.required,c.min(1),c.max(20)]],estado:["pendiente",c.required],notas:[""]}),this.loadMesas(),this._reloadSubscription=this._reservasService.reload$.subscribe(()=>{this.loadMesas()})}ngOnDestroy(){this._reloadSubscription&&this._reloadSubscription.unsubscribe()}loadMesas(){this._reservasService.getMesas().subscribe({next:t=>{console.log("\u{1F4CB} Componente: Mesas recibidas del servicio:",t),console.log("\u{1F50D} Primera mesa:",t[0]),this.mesas=t.filter(r=>!r.deleted_at),console.log("\u2705 Componente: Mesas filtradas (disponibles):",this.mesas),this._cdr.markForCheck()},error:t=>{console.error("\u274C Componente: Error al cargar mesas:",t),this.errorMessage="Error al cargar las mesas disponibles",this._cdr.markForCheck()}})}onSave(){if(this.createForm.valid){this.isSaving=!0,this.errorMessage="";let t=this.createForm.value,r=new Date(t.fecha_hora).toISOString(),n={mesa_id:Number(t.mesa_id),cliente_nombre:t.cliente_nombre,fecha_hora:r,numero_personas:Number(t.numero_personas),estado:t.estado,notas:t.notas};t.cliente_telefono&&t.cliente_telefono.trim()&&(n.cliente_telefono=t.cliente_telefono.trim()),this._reservasService.createReserva(n).subscribe({next:()=>{this.isSaving=!1,this._cdr.markForCheck(),this._router.navigate(["/admin/reservas-mesas"])},error:s=>{this.isSaving=!1,this._cdr.markForCheck(),s.status===400?this.errorMessage="Datos inv\xE1lidos. Verifique que todos los campos est\xE9n completos correctamente.":s.status===500?this.errorMessage="Error interno del servidor. Intente nuevamente m\xE1s tarde.":s.status===0||!s.status?this.errorMessage="No se pudo conectar al servidor. Verifique su conexi\xF3n a internet.":this.errorMessage=`Error al crear la reserva: ${s.message||"Error desconocido"}`}})}else console.log("Form is invalid, errors:",this.createForm.errors),this.errorMessage="Por favor, complete todos los campos requeridos correctamente",this.isSaving=!1}onCancel(){this._router.navigate(["/admin/reservas-mesas"])}getTodayDate(){return new Date().toISOString().split("T")[0]}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=E({type:e,selectors:[["admin-reservas-create-reserva-page"]],decls:61,vars:12,consts:[[1,"bg-gray-900","text-gray-100","min-h-screen","p-6"],[1,"max-w-2xl","mx-auto"],[1,"flex","justify-between","items-center","border-b-2","border-orange-500","p-4","bg-gray-800","shadow-md","mb-6","rounded-lg"],[1,"px-6","py-2","rounded-full","bg-orange-500","text-white","text-xl","font-bold","shadow-md"],[1,"btn","bg-gray-600","hover:bg-gray-700","text-white",3,"click"],[1,"bg-gray-800","rounded-xl","shadow-lg","border","border-gray-700"],[1,"p-6"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"bg-red-600","text-white","p-4","rounded-lg","mb-4"],[1,"block","text-sm","font-bold","text-orange-400","mb-2"],["formControlName","mesa_id",1,"w-full","px-3","py-2","bg-gray-700","border","border-gray-600","rounded-md","text-gray-100","focus:outline-none","focus:ring-2","focus:ring-orange-500"],["value",""],[3,"value"],[1,"text-red-400","text-sm","mt-1"],["type","text","formControlName","cliente_nombre","placeholder","Nombre completo del cliente",1,"w-full","px-3","py-2","bg-gray-700","border","border-gray-600","rounded-md","text-gray-100","placeholder-gray-400","focus:outline-none","focus:ring-2","focus:ring-orange-500"],["type","tel","formControlName","cliente_telefono","placeholder","N\xFAmero de tel\xE9fono (opcional)",1,"w-full","px-3","py-2","bg-gray-700","border","border-gray-600","rounded-md","text-gray-100","placeholder-gray-400","focus:outline-none","focus:ring-2","focus:ring-orange-500"],["type","datetime-local","formControlName","fecha_hora",1,"w-full","px-3","py-2","bg-gray-700","border","border-gray-600","rounded-md","text-gray-100","focus:outline-none","focus:ring-2","focus:ring-orange-500",3,"min"],["type","number","formControlName","numero_personas","placeholder","Cantidad de personas","min","1","max","20",1,"w-full","px-3","py-2","bg-gray-700","border","border-gray-600","rounded-md","text-gray-100","placeholder-gray-400","focus:outline-none","focus:ring-2","focus:ring-orange-500"],["formControlName","estado",1,"w-full","px-3","py-2","bg-gray-700","border","border-gray-600","rounded-md","text-gray-100","focus:outline-none","focus:ring-2","focus:ring-orange-500"],["formControlName","notas","placeholder","Notas adicionales sobre la reserva...","rows","3",1,"w-full","px-3","py-2","bg-gray-700","border","border-gray-600","rounded-md","text-gray-100","placeholder-gray-400","focus:outline-none","focus:ring-2","focus:ring-orange-500"],[1,"flex","justify-end","gap-3"],["type","button",1,"btn","bg-gray-600","hover:bg-gray-700","text-white",3,"click","disabled"],["type","submit",1,"btn","bg-orange-500","hover:bg-orange-600","text-white","disabled:opacity-50",3,"disabled"],[1,"loading","loading-spinner","loading-sm"]],template:function(r,n){if(r&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h1",3),a(5," \u{1F4C5} Crear Nueva Reserva "),i()(),l(6,"div")(7,"button",4),y("click",function(){return n.onCancel()}),a(8," \u274C Cancelar "),i()()(),l(9,"div",5)(10,"div",6)(11,"form",7),y("ngSubmit",function(){return n.onSave()}),m(12,Q,2,1,"div",8),l(13,"div")(14,"label",9),a(15," Mesa * "),i(),l(16,"select",10)(17,"option",11),a(18,"Seleccione una mesa"),i(),R(19,X,4,4,"option",12,J),i(),m(21,Y,2,0,"div",13),i(),l(22,"div")(23,"label",9),a(24," Nombre del Cliente * "),i(),g(25,"input",14),m(26,te,3,2,"div",13),i(),l(27,"div")(28,"label",9),a(29," Tel\xE9fono "),i(),g(30,"input",15),m(31,re,2,1,"div",13),i(),l(32,"div")(33,"label",9),a(34," Fecha y Hora de Reserva * "),i(),g(35,"input",16),m(36,ie,2,0,"div",13),i(),l(37,"div")(38,"label",9),a(39," N\xFAmero de Personas * "),i(),g(40,"input",17),m(41,se,4,3,"div",13),i(),l(42,"div")(43,"label",9),a(44," Estado * "),i(),l(45,"select",18)(46,"option",11),a(47,"Seleccione un estado"),i(),R(48,de,2,2,"option",12,K),i(),m(50,me,2,0,"div",13),i(),l(51,"div")(52,"label",9),a(53," Notas "),i(),g(54,"textarea",19),i(),l(55,"div",20)(56,"button",21),y("click",function(){return n.onCancel()}),a(57," \u274C Cancelar "),i(),l(58,"button",22),m(59,ce,2,0)(60,ue,1,0),i()()()()()()()),r&2){let s,u,C,b,x,h;o(11),p("formGroup",n.createForm),o(),d(n.errorMessage?12:-1),o(7),S(n.mesas),o(2),d((s=n.createForm.get("mesa_id"))!=null&&s.invalid&&((s=n.createForm.get("mesa_id"))!=null&&s.touched)?21:-1),o(5),d((u=n.createForm.get("cliente_nombre"))!=null&&u.invalid&&((u=n.createForm.get("cliente_nombre"))!=null&&u.touched)?26:-1),o(5),d((C=n.createForm.get("cliente_telefono"))!=null&&C.invalid&&((C=n.createForm.get("cliente_telefono"))!=null&&C.touched)?31:-1),o(4),p("min",n.getTodayDate()+"T11:00"),o(),d((b=n.createForm.get("fecha_hora"))!=null&&b.invalid&&((b=n.createForm.get("fecha_hora"))!=null&&b.touched)?36:-1),o(5),d((x=n.createForm.get("numero_personas"))!=null&&x.invalid&&((x=n.createForm.get("numero_personas"))!=null&&x.touched)?41:-1),o(7),S(n.estadoOptions),o(2),d((h=n.createForm.get("estado"))!=null&&h.invalid&&((h=n.createForm.get("estado"))!=null&&h.touched)?50:-1),o(6),p("disabled",n.isSaving),o(2),p("disabled",n.createForm.invalid||n.isSaving),o(),d(n.isSaving?59:60)}},dependencies:[T,L,k,$,G,M,q,V,D,w,B,j,I,O],encapsulation:2,changeDetection:0})},Ee=F;export{F as AdminReservasCreateReservaPageComponent,Ee as default};
