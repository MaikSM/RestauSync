import{a as q}from"./chunk-TZQFGA7U.js";import{a as A,b as g,c as D,d as k,g as N,h as T,i as P,j as V,k as j,l as w,m as G,q as L,s as z}from"./chunk-AG2IGI7A.js";import"./chunk-NMI43S2G.js";import{b as y,d as R}from"./chunk-UFL7QPX4.js";import"./chunk-7IYL6UTE.js";import{m as S,q as F}from"./chunk-JQOZS3TN.js";import{Aa as l,Bb as o,Cb as M,Db as E,Na as x,R as u,Sa as c,Wb as I,Z as f,Za as d,_ as b,ab as v,gb as n,hb as a,ib as m,mb as C,pb as _,qb as p}from"./chunk-CFQE6O6P.js";import"./chunk-4X36HX5K.js";function O(i,s){i&1&&(n(0,"div",8),m(1,"span",9),n(2,"span",10),o(3,"Cargando datos de la mesa..."),a()())}function B(i,s){if(i&1&&(n(0,"div",11),m(1,"i",12),n(2,"span"),o(3),a()()),i&2){let e=p();l(3),M(e.errorMessage)}}function U(i,s){i&1&&(n(0,"span"),o(1,"El n\xFAmero de mesa es requerido"),a())}function $(i,s){i&1&&(n(0,"span"),o(1,"El n\xFAmero debe ser mayor a 0"),a())}function H(i,s){if(i&1&&(n(0,"div",35),c(1,U,2,0,"span",36)(2,$,2,0,"span",36),a()),i&2){let e,t,r=p(2);l(),d("ngIf",(e=r.editForm.get("numero"))==null||e.errors==null?null:e.errors.required),l(),d("ngIf",(t=r.editForm.get("numero"))==null||t.errors==null?null:t.errors.min)}}function J(i,s){i&1&&(n(0,"span"),o(1,"La capacidad es requerida"),a())}function K(i,s){i&1&&(n(0,"span"),o(1,"La capacidad debe ser mayor a 0"),a())}function Q(i,s){if(i&1&&(n(0,"div",35),c(1,J,2,0,"span",36)(2,K,2,0,"span",36),a()),i&2){let e,t,r=p(2);l(),d("ngIf",(e=r.editForm.get("capacidad"))==null||e.errors==null?null:e.errors.required),l(),d("ngIf",(t=r.editForm.get("capacidad"))==null||t.errors==null?null:t.errors.min)}}function W(i,s){i&1&&m(0,"span",37)}function X(i,s){if(i&1){let e=C();n(0,"div",13)(1,"div",14)(2,"div",15)(3,"h2",16),o(4,"Datos de la Mesa"),a(),n(5,"form",17),_("ngSubmit",function(){f(e);let r=p();return b(r.onSubmit())}),n(6,"div",18)(7,"label",19)(8,"span",20),o(9,"N\xFAmero de Mesa"),a()(),m(10,"input",21),c(11,H,3,2,"div",22),a(),n(12,"div",18)(13,"label",19)(14,"span",20),o(15,"Capacidad (personas)"),a()(),m(16,"input",23),c(17,Q,3,2,"div",22),a(),n(18,"div",18)(19,"label",19)(20,"span",20),o(21,"Estado"),a()(),n(22,"select",24)(23,"option",25),o(24,"Libre"),a(),n(25,"option",26),o(26,"Reservada"),a(),n(27,"option",27),o(28,"Ocupada"),a(),n(29,"option",28),o(30,"Mantenimiento"),a()()(),n(31,"div",29)(32,"label",19)(33,"span",20),o(34,"Ubicaci\xF3n (opcional)"),a()(),m(35,"input",30),a(),n(36,"div",31)(37,"button",32),_("click",function(){f(e);let r=p();return b(r.onCancel())}),o(38," Cancelar "),a(),n(39,"button",33),c(40,W,1,0,"span",34),o(41),a()()()()()()}if(i&2){let e,t,r=p();l(5),d("formGroup",r.editForm),l(5),v(r.getInputClass("numero")),l(),d("ngIf",((e=r.editForm.get("numero"))==null?null:e.invalid)&&((e=r.editForm.get("numero"))==null?null:e.touched)),l(5),v(r.getInputClass("capacidad")),l(),d("ngIf",((t=r.editForm.get("capacidad"))==null?null:t.invalid)&&((t=r.editForm.get("capacidad"))==null?null:t.touched)),l(5),v(r.getInputClass("estado")),l(17),d("disabled",r.editForm.invalid||r.isSubmitting),l(),d("ngIf",r.isSubmitting),l(),E(" ",r.isSubmitting?"Guardando...":"Guardar Cambios"," ")}}var h=class i{_router=u(R);_route=u(y);_reservasService=u(q);_fb=u(L);_cdr=u(I);editForm;isLoading=!1;isSubmitting=!1;errorMessage="";mesa=null;mesaId=null;ngOnInit(){this.initializeForm(),this.loadMesaData()}loadMesaData(){this._route.params.subscribe(s=>{let e=s.id;if(console.log("\u{1F50D} ID de mesa obtenido de la ruta (subscribe):",e),console.log("\u{1F50D} Par\xE1metros completos de la ruta:",s),!e||isNaN(+e)){this.errorMessage=`ID de mesa no v\xE1lido: ${e}`,console.error("\u274C ID de mesa inv\xE1lido:",e);return}this.mesaId=+e,console.log("\u{1F4BE} ID de mesa guardado persistentemente:",this.mesaId),this.isLoading=!0,this.errorMessage="",console.log("\u{1F4E1} Cargando datos de la mesa con ID:",this.mesaId),this._reservasService.getMesaById(this.mesaId).subscribe({next:t=>{this.mesa=t,this.editForm.patchValue({numero:t.numero,capacidad:t.capacidad,estado:t.estado,ubicacion:t.ubicacion||""}),this.isLoading=!1,this._cdr.markForCheck(),console.log("\u2705 Datos de la mesa cargados:",t),console.log("\u2705 Mesa object despu\xE9s de cargar:",this.mesa)},error:t=>{this.isLoading=!1,this._cdr.markForCheck(),t.status===404?this.errorMessage="Mesa no encontrada":t.status===401?this.errorMessage="No tienes permisos para ver esta mesa":this.errorMessage="Error al cargar los datos de la mesa",console.error("Error loading mesa:",t)}})})}initializeForm(){this.editForm=this._fb.group({numero:["",[g.required,g.min(1)]],capacidad:["",[g.required,g.min(1)]],estado:["libre",g.required],ubicacion:[""]})}getInputClass(s){let e=this.editForm.get(s);return e?.invalid&&e?.touched?"input-error":"input-bordered"}onSubmit(){if(this.editForm.valid&&(this.mesa||this.mesaId)){this.isSubmitting=!0,this.errorMessage="";let s=this.editForm.value;console.log("\u{1F4DD} Intentando actualizar mesa:"),console.log("   - Mesa object:",this.mesa),console.log("   - Mesa ID (objeto):",this.mesa?.id),console.log("   - Mesa ID (guardado):",this.mesaId),console.log("   - Datos a actualizar:",s);let e=this.mesa?.id||this.mesaId;if(!e||isNaN(e)){console.error("\u274C ID de mesa inv\xE1lido para actualizaci\xF3n:",e),console.error("\u274C Mesa object completo:",this.mesa),console.error("\u274C Mesa ID guardado:",this.mesaId),this.errorMessage="Error: ID de mesa inv\xE1lido",this.isSubmitting=!1,this._cdr.markForCheck();return}this._reservasService.updateMesa(e,s).subscribe({next:()=>{this.isSubmitting=!1,this._cdr.markForCheck(),console.log("\u2705 Mesa actualizada correctamente"),this._router.navigate(["/admin/reservas-mesas"])},error:t=>{this.isSubmitting=!1,this._cdr.markForCheck(),t.status===400?this.errorMessage="Datos inv\xE1lidos. Verifica la informaci\xF3n ingresada.":t.status===401?this.errorMessage="No tienes permisos para actualizar esta mesa":this.errorMessage="Error al actualizar la mesa. Intente nuevamente.",console.error("Error updating mesa:",t)}})}else this.markFormGroupTouched()}markFormGroupTouched(){Object.keys(this.editForm.controls).forEach(s=>{this.editForm.get(s)?.markAsTouched()}),this._cdr.markForCheck()}onCancel(){this._router.navigate(["/admin/reservas-mesas"])}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=x({type:i,selectors:[["admin-reservas-edit-mesa-page"]],decls:9,vars:3,consts:[[1,"p-6"],[1,"flex","items-center","mb-6"],[1,"btn","btn-ghost","btn-sm","mr-4",3,"click"],[1,"fas","fa-arrow-left"],[1,"text-3xl","font-bold","text-primary"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","alert alert-error mb-6",4,"ngIf"],["class","max-w-md mx-auto",4,"ngIf"],[1,"flex","justify-center","items-center","py-8"],[1,"loading","loading-spinner","loading-lg"],[1,"ml-2"],[1,"alert","alert-error","mb-6"],[1,"fas","fa-exclamation-triangle"],[1,"max-w-md","mx-auto"],[1,"card","bg-base-100","shadow-lg"],[1,"card-body"],[1,"card-title","mb-4"],[3,"ngSubmit","formGroup"],[1,"form-control","mb-4"],[1,"label"],[1,"label-text"],["type","number","formControlName","numero","placeholder","Ej: 1, 2, 3...",1,"input","input-bordered"],["class","text-error text-sm mt-1",4,"ngIf"],["type","number","formControlName","capacidad","placeholder","Ej: 2, 4, 6...",1,"input","input-bordered"],["formControlName","estado",1,"select","select-bordered"],["value","libre"],["value","reservada"],["value","ocupada"],["value","mantenimiento"],[1,"form-control","mb-6"],["type","text","formControlName","ubicacion","placeholder","Ej: Terraza, Interior, Ventana...",1,"input","input-bordered"],[1,"flex","gap-2","justify-end"],["type","button",1,"btn","btn-ghost",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","loading loading-spinner loading-sm",4,"ngIf"],[1,"text-error","text-sm","mt-1"],[4,"ngIf"],[1,"loading","loading-spinner","loading-sm"]],template:function(e,t){e&1&&(n(0,"div",0)(1,"div",1)(2,"button",2),_("click",function(){return t.onCancel()}),m(3,"i",3),a(),n(4,"h1",4),o(5,"Editar Mesa"),a()(),c(6,O,4,0,"div",5)(7,B,4,1,"div",6)(8,X,42,12,"div",7),a()),e&2&&(l(6),d("ngIf",t.isLoading),l(),d("ngIf",t.errorMessage&&!t.isLoading),l(),d("ngIf",!t.isLoading&&!t.errorMessage))},dependencies:[F,S,z,N,w,G,A,T,j,D,k,P,V],encapsulation:2})},ce=h;export{h as AdminReservasEditMesaPageComponent,ce as default};
