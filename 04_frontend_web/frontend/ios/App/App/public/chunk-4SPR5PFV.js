import"./chunk-HJXXEJKO.js";import{a as W,b as X,c as Y,d as Z,e as ee,f as te}from"./chunk-E5IQYEPL.js";import{a as k}from"./chunk-KHIHIFVV.js";import{a as J,b as K,c as Q}from"./chunk-CCYSTRO3.js";import"./chunk-L57FSASQ.js";import{a as y}from"./chunk-7IX7VPDF.js";import{a as q}from"./chunk-DLFABNFZ.js";import"./chunk-YKSGIHVP.js";import{d as M,e as U}from"./chunk-BBMTBTDA.js";import"./chunk-IJHKA2LB.js";import{g as G,m as T}from"./chunk-IBNRR53B.js";import{$a as b,Eb as z,I as E,Ja as F,Oa as _,R as v,Ua as m,Va as P,Ya as w,Z as p,Za as S,_ as g,ab as f,bb as r,cb as i,db as x,eb as O,fb as $,hb as h,ka as N,kb as u,lb as s,ma as R,tb as j,ua as D,ub as d,vb as H,wb as C,xa as l,xb as B}from"./chunk-GQXGSY3T.js";import"./chunk-YEWEO3AL.js";var V=(t,n,e,o)=>{try{return e=e.toLowerCase(),Object.values(t.original).map(c=>c).join(" ").toLowerCase().includes(e)}catch(a){return console.error(a),!1}},ie=[{id:"id",accessorFn:t=>t.id,cell:t=>t.getValue(),header:"ID",filterFn:V},{id:"name",accessorFn:t=>t.name,cell:t=>t.getValue(),header:"Nombre",filterFn:V},{id:"description",accessorFn:t=>t.description,cell:t=>t.getValue(),header:"Descripci\xF3n",filterFn:V},{id:"users",accessorFn:t=>t.users?.length,cell:t=>t.getValue(),header:"# Usuarios",filterFn:V},{id:"actions",header:"Acciones",enableSorting:!1,enableHiding:!1,enableColumnFilter:!1}],ne=ie;var oe=(t,n,e)=>({"!text-left":t,"!text-right":n,"!text-center":e});function ae(t,n){if(t&1){let e=h();O(0),r(1,"button",17),u("click",function(){p(e);let a=s(2).$implicit,c=s(2);return g(c.onSort(a.column))}),x(2,"span",18),i(),$()}if(t&2){let e=n.$implicit;l(2),m("innerHTML",e,D)}}function se(t,n){if(t&1&&(r(0,"th",15),_(1,ae,3,1,"ng-container",16),i()),t&2){let e=s(),o=e.$implicit,a=e.$index,c=s().$implicit;m("ngClass",z(3,oe,a===0,a===c.headers.length-1,a>0&&a<c.headers.length-1)),l(),m("flexRender",o.column.columnDef.header)("flexRenderProps",o.getContext())}}function de(t,n){if(t&1&&_(0,se,2,7,"th",15),t&2){let e=n.$implicit;w(e.isPlaceholder?-1:0)}}function ce(t,n){if(t&1&&(r(0,"tr",6),b(1,de,1,1,null,null,S),i()),t&2){let e=n.$implicit;l(),f(e.headers)}}function me(t,n){if(t&1){let e=h();r(0,"input",22),u("change",function(){p(e);let a=s(2).$implicit;return g(a.toggleSelected())}),i()}if(t&2){let e=s(2).$implicit;m("checked",e.getIsSelected())}}function pe(t,n){if(t&1){let e=h();r(0,"div",21)(1,"button",23),u("click",function(){p(e);let a=s(2).$implicit,c=s();return g(c.onEdit(a))}),d(2," Editar "),i(),r(3,"button",24),u("click",function(){p(e);let a=s(2).$implicit,c=s();return g(c.onDelete(a))}),d(4," Eliminar "),i()()}}function ge(t,n){if(t&1&&(O(0),x(1,"span",25),$()),t&2){let e=n.$implicit;l(),m("innerHTML",e,D)}}function ue(t,n){if(t&1&&_(0,ge,2,1,"ng-container",16),t&2){let e=s().$implicit;m("flexRender",e.column.columnDef.cell)("flexRenderProps",e.getContext())}}function _e(t,n){if(t&1&&(r(0,"td",19),_(1,me,1,1,"input",20)(2,pe,5,0,"div",21)(3,ue,1,2,"ng-container"),i()),t&2){let e=n.$implicit,o=n.$index,a=s().$implicit;m("ngClass",z(2,oe,o===0,o===a.getVisibleCells().length-1,o>0&&o<a.getVisibleCells().length-1)),l(),w(e.column.id==="select"?1:e.column.id==="actions"?2:3)}}function be(t,n){if(t&1&&(r(0,"tr",7),b(1,_e,4,6,"td",19,S),i()),t&2){let e=n.$implicit;l(),f(e.getVisibleCells())}}function fe(t,n){t&1&&(r(0,"tr",8)(1,"td",26),d(2," No hay datos para mostrar "),i()())}function xe(t,n){if(t&1&&(r(0,"option",12),d(1),i()),t&2){let e=n.$implicit,o=s();m("value",e)("selected",e===o.table.getState().pagination.pageSize),l(),C(" ",e," ")}}var A=class t{_rolesService=v(k);_router=v(M);roles=N.required();_pagination=R({pageIndex:0,pageSize:10});sizesPages=R([1,3,5,10,20]);_sortingState=R([]);_columnVisibility=R({});_columnFilter=R([]);table=te(()=>({data:this.roles(),getCoreRowModel:W(),columns:ne,getPaginationRowModel:Y(),getSortedRowModel:Z(),getFilteredRowModel:X(),enableRowSelection:!0,state:{pagination:this._pagination(),sorting:this._sortingState(),columnVisibility:this._columnVisibility(),columnFilters:this._columnFilter()},onPaginationChange:n=>{typeof n=="function"?this._pagination.update(n):this._pagination.set(n)},onSortingChange:n=>{typeof n=="function"?this._sortingState.update(n):this._sortingState.set(n)},onColumnVisibilityChange:n=>{let e=n instanceof Function?n(this._columnVisibility()):n;this._columnVisibility.set(e)},onColumnFiltersChange:n=>{n instanceof Function?this._columnFilter.update(n):this._columnFilter.set(n)}}));onChangePageSize(n){try{let e=n.target;this.table.setPageSize(Number(e.value))}catch(e){console.error(e)}}onSort(n){try{n.toggleSorting(n.getIsSorted()==="asc")}catch(e){console.error(e)}}onSearch(n){try{this.table.getAllColumns().map(o=>o.id).filter(o=>o!=="select"&&o!=="actions").forEach(o=>{this.table.getColumn(o)?.setFilterValue(n)})}catch(e){console.error(e)}}onEdit(n){try{if(this._rolesService.forbidenRoles().includes(n.original.id)){y.error("\xC9ste Rol, No Puede ser Editado",{description:"Este rol es un rol de sistema y no puede ser editado"});return}this._router.navigate(["admin/roles/edit",n.original.id])}catch(e){console.error(e),y.error("Error al Editar el Rol",{description:"Error al Editar el Rol, por favor intente de nuevo"})}}onDelete(n){try{if(this._rolesService.forbidenRoles().includes(n.original.id)){y.error("\xC9ste Rol, No Puede ser Eliminado",{description:"Este rol es un rol de sistema y no puede ser eliminado"});return}confirm("\xBFEst\xE1 Seguro de Eliminar \xC9ste Registro?")&&this._rolesService.deleteById(n.original.id).pipe(E(()=>this._rolesService.getAll().subscribe())).subscribe({next:()=>{y.success("Registro Eliminado",{description:"El Registro ha sido eliminado correctamente"}),location.reload()},error:e=>{console.error(e),y.error("Error al Eliminar el Registro",{description:"Error al Eliminar el Registro, por favor intente de nuevo"})}})}catch(e){console.error(e),y.error("Error al Eliminar el Rol",{description:"Error al Eliminar el Rol, por favor intente de nuevo"})}}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=F({type:t,selectors:[["admin-roles-table"]],inputs:{roles:[1,"roles"]},decls:30,vars:6,consts:[["input",""],[1,"p-1"],[1,"!w-full","!overflow-x-auto","!rounded-lg","!shadow-lg","!border","!border-gray-700","!bg-gray-800","!p-1"],[1,"!table","!w-full","!bg-gray-800","!rounded-lg","!overflow-hidden"],[1,"flex","justify-items-start","items-center","gap-1","mb-1"],["type","text","placeholder","Buscar ...",1,"!w-full","!px-3","!py-2","!bg-gray-700","!border","!border-gray-600","!rounded-md","!text-gray-100","!placeholder-gray-400","!focus:outline-none","!focus:ring-2","!focus:ring-orange-500",3,"input"],[1,"!border-b","!border-gray-700","!bg-gray-700","!text-orange-400"],[1,"!border-b","!border-gray-700","!bg-white","!text-gray-900","!hover:bg-white"],[1,"!border-b","!border-gray-700","!bg-white","!text-gray-900"],[1,"!w-full","!shadow-md","!p-2","!flex","!flex-col","!sm:flex-row","!items-center","!justify-between","!space-y-2","!sm:space-y-0","!sm:space-x-4","!z-50"],[1,"!text-sm","!rounded-2xl","!shadow","!px-3","!py-1","!bg-gray-700","!text-gray-100"],[1,"!w-full","!px-3","!py-2","!bg-gray-700","!border","!border-gray-600","!rounded-md","!text-gray-100","!focus:outline-none","!focus:ring-2","!focus:ring-orange-500",3,"change"],[3,"value","selected"],[1,"flex","items-center","space-x-2"],[1,"!bg-orange-500","!hover:bg-orange-600","!text-white","!px-3","!py-1","!rounded","!text-sm","!transition","!duration-200",3,"click","disabled"],[1,"!px-4","!py-3","!text-sm","!uppercase","!tracking-wider","!font-bold",3,"ngClass"],[4,"flexRender","flexRenderProps"],[1,"!bg-gray-600","!hover:bg-gray-500","!text-orange-400","!px-2","!py-1","!rounded","!text-xs","!transition","!duration-200",3,"click"],[1,"flex","items-center","space-x-1",3,"innerHTML"],[1,"!px-4","!py-3","!text-sm",3,"ngClass"],["type","checkbox",1,"!checkbox","!w-4","!h-4","!text-orange-500","!bg-gray-700","!border-gray-600","!rounded","!focus:ring-orange-500",3,"checked"],[1,"flex","justify-end","gap-2"],["type","checkbox",1,"!checkbox","!w-4","!h-4","!text-orange-500","!bg-gray-700","!border-gray-600","!rounded","!focus:ring-orange-500",3,"change","checked"],[1,"!bg-orange-500","!hover:bg-orange-600","!text-white","!px-3","!py-1","!rounded","!text-sm","!transition","!duration-200",3,"click"],[1,"!bg-red-600","!hover:bg-red-700","!text-white","!px-3","!py-1","!rounded","!text-sm","!transition","!duration-200",3,"click"],[1,"inline-block",3,"innerHTML"],["colspan","100%",1,"!text-center","!text-sm","!font-bold","!text-gray-500","!py-8"]],template:function(e,o){if(e&1){let a=h();r(0,"div",1)(1,"div",2)(2,"table",3)(3,"caption")(4,"div",4)(5,"input",5,0),u("input",function(){p(a);let I=j(6);return g(o.onSearch(I.value))}),i()()(),r(7,"thead"),b(8,ce,3,0,"tr",6,S),i(),r(10,"tbody"),b(11,be,3,0,"tr",7,S,!1,fe,3,0,"tr",8),i()()(),r(14,"div",9)(15,"div")(16,"span",10),d(17),i()(),r(18,"div")(19,"select",11),u("change",function(I){return p(a),g(o.onChangePageSize(I))}),b(20,xe,2,3,"option",12,S),i()(),r(22,"div")(23,"span",10),d(24),i()(),r(25,"div",13)(26,"button",14),u("click",function(){return p(a),g(o.table.previousPage())}),d(27," Anterior "),i(),r(28,"button",14),u("click",function(){return p(a),g(o.table.nextPage())}),d(29," Siguiente "),i()()()()}e&2&&(l(8),f(o.table.getHeaderGroups()),l(3),f(o.table.getRowModel().rows),l(6),B(" Mostrando: ",o.table.getRowModel().rows.length," de ",o.table.getRowCount()," "),l(3),f(o.sizesPages()),l(4),C(" ",o.table.getState().pagination.pageIndex+1," "),l(2),m("disabled",!o.table.getCanPreviousPage()),l(2),m("disabled",!o.table.getCanNextPage()))},dependencies:[T,G,ee],styles:["[_nghost-%COMP%]   table[_ngcontent-%COMP%]{background-color:#1f2937!important;border-radius:.5rem!important;overflow:hidden!important}[_nghost-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#374151!important;color:#fb923c!important}[_nghost-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#fff!important;color:#111827!important;border-bottom:1px solid rgb(75 85 99)!important}[_nghost-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#fff!important}[_nghost-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], [_nghost-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1rem!important;text-align:left!important}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{background-color:#374151!important;border-color:#4b5563!important;color:#f3f4f6!important}[_nghost-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none!important;border-color:#fb923c!important;box-shadow:0 0 0 2px #fb923c33!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:.375rem!important;transition:all .2s!important}[_nghost-%COMP%]   select[_ngcontent-%COMP%]{background-color:#374151!important;border-color:#4b5563!important;color:#f3f4f6!important}[_nghost-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none!important;border-color:#fb923c!important;box-shadow:0 0 0 2px #fb923c33!important}[_nghost-%COMP%]   .badge[_ngcontent-%COMP%]{background-color:initial!important;color:initial!important;border-radius:9999px!important;padding:.25rem .5rem!important;font-size:.75rem!important;font-weight:600!important}"],changeDetection:0})};var Ce=(t,n)=>n.id;function he(t,n){t&1&&x(0,"is-error")}function ye(t,n){t&1&&x(0,"is-loading")}function ve(t,n){if(t&1&&(r(0,"p",12),d(1),i()),t&2){let e=s().$implicit;l(),C(" ",e.description," ")}}function Re(t,n){if(t&1){let e=h();r(0,"div",6)(1,"div",9)(2,"div",10)(3,"h2",11),d(4),i(),_(5,ve,2,1,"p",12),i(),r(6,"span",13),d(7),i()(),r(8,"div",14)(9,"span",15),d(10," Usuarios: "),r(11,"span",16),d(12),i()(),r(13,"span",17),d(14),i()(),r(15,"div",18)(16,"button",19),u("click",function(){let a=p(e).$implicit,c=s(2);return g(c.onEditRole(a.id))}),d(17," \u270F\uFE0F Editar "),i(),r(18,"button",20),u("click",function(){let a=p(e).$implicit,c=s(2);return g(c.onDeleteRole(a.id))}),d(19," \u{1F5D1}\uFE0F Eliminar "),i()()()}if(t&2){let e=n.$implicit,o=s(2);l(4),C(" ",e.name," "),l(),w(e.description?5:-1),l(2),C(" ID: ",e.id," "),l(5),H((e.users==null?null:e.users.length)||0),l(),P("bg-green-600",((e.users==null?null:e.users.length)||0)>0)("text-white",((e.users==null?null:e.users.length)||0)>0)("bg-gray-700",((e.users==null?null:e.users.length)||0)===0)("text-gray-200",((e.users==null?null:e.users.length)||0)===0),l(),C(" ",((e.users==null?null:e.users.length)||0)>0?"En uso":"Sin usuarios"," "),l(2),P("opacity-70",o.isForbidden(e.id)),m("disabled",o.isForbidden(e.id)),l(2),P("opacity-70",o.isForbidden(e.id)),m("disabled",o.isForbidden(e.id))}}function we(t,n){if(t&1&&(r(0,"div",5),b(1,Re,20,19,"div",6,Ce),i(),r(3,"div",7),x(4,"admin-roles-table",8),i()),t&2){let e=s();l(),f(e.rolesResource.value()),l(3),m("roles",e.rolesResource.value())}}function Se(t,n){t&1&&x(0,"is-empty")}var L=class t{_rolesService=v(k);_router=v(M);rolesResource=q({loader:()=>this._rolesService.getAll()});isForbidden(n){try{return this._rolesService.forbidenRoles().includes(n)}catch{return!1}}onEditRole(n){try{if(this.isForbidden(n)){alert("Este rol es de sistema y no puede ser editado.");return}this._router.navigate(["admin/roles/edit",n])}catch(e){console.error(e),alert("Error al intentar editar el rol.")}}onDeleteRole(n){try{if(this.isForbidden(n)){alert("Este rol es de sistema y no puede ser eliminado.");return}if(!confirm("\xBFEst\xE1 seguro de eliminar este rol?"))return;this._rolesService.deleteById(n).pipe(E(()=>this._rolesService.getAll().subscribe())).subscribe({next:()=>{location.reload()},error:e=>{console.error(e),alert("Error al eliminar el rol, por favor intente de nuevo.")}})}catch(e){console.error(e),alert("Error al eliminar el rol.")}}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=F({type:t,selectors:[["admin-roles-page"]],decls:11,vars:1,consts:[[1,"bg-gray-900","text-gray-100","min-h-screen","p-4","sm:p-6","overflow-x-hidden"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","gap-3","border-b-2","border-orange-500","p-4","bg-gray-800","shadow-md","mb-6","rounded-lg"],[1,"text-center","sm:text-left","text-2xl","sm:text-3xl","font-bold","text-white"],[1,"w-full","sm:w-auto"],["routerLink","/admin/roles/create",1,"btn","btn-sm","sm:btn-md","bg-orange-500","hover:bg-orange-600","text-white","w-full","sm:w-auto","whitespace-nowrap"],[1,"md:hidden","grid","grid-cols-1","sm:grid-cols-2","gap-3"],[1,"bg-gray-800","border","border-gray-700","rounded-lg","p-4","shadow"],[1,"hidden","md:block"],[3,"roles"],[1,"flex","items-start","justify-between","gap-2"],[1,"min-w-0"],[1,"text-lg","font-semibold","text-orange-400","break-words"],[1,"mt-1","text-sm","text-gray-300","break-words"],[1,"text-xs","px-2","py-1","bg-gray-700","text-gray-200","rounded"],[1,"mt-3","flex","items-center","justify-between","text-sm"],[1,"text-gray-300"],[1,"font-semibold"],[1,"text-[11px]","px-2","py-1","rounded-full"],[1,"mt-3","flex","gap-2"],["title","Editar rol",1,"bg-orange-500","hover:bg-orange-600","text-white","px-3","py-1.5","rounded","text-sm","transition","w-full",3,"click","disabled"],["title","Eliminar rol",1,"bg-red-600","hover:bg-red-700","text-white","px-3","py-1.5","rounded","text-sm","transition","w-full",3,"click","disabled"]],template:function(e,o){e&1&&(r(0,"div",0)(1,"div",1)(2,"h1",2),d(3," \u{1F464} Roles "),i(),r(4,"div",3)(5,"a",4),d(6," \u2795 Crear Rol "),i()()(),_(7,he,1,0,"is-error")(8,ye,1,0,"is-loading")(9,we,5,1)(10,Se,1,0,"is-empty"),i()),e&2&&(l(7),w(o.rolesResource.error()?7:o.rolesResource.isLoading()?8:o.rolesResource.hasValue()?9:o.rolesResource.hasValue()?-1:10))},dependencies:[T,U,J,K,Q,A],encapsulation:2,changeDetection:0})},it=L;export{L as AdminRolesPageComponent,it as default};
