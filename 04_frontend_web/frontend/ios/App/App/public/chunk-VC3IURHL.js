import{a as m}from"./chunk-DLFABNFZ.js";import{a as d}from"./chunk-YKSGIHVP.js";import{a as k}from"./chunk-IJHKA2LB.js";import{L as p,R as g,Ub as u,j as h,ma as i,o as s,w as o}from"./chunk-GQXGSY3T.js";import{a as l,b as c}from"./chunk-YEWEO3AL.js";var A=d.apiUrl,n=`${A}/auth`,S=class a{_http=g(k);_authStatus=i("checking");_user=i(null);_token=i(localStorage.getItem("token"));checkStatusResource=m({loader:()=>this.checkAuthStatus()});logPrivateProperties(){console.log({authStatus:this.authStatus(),user:this.user(),token:this.token()})}authStatus=u(()=>this._authStatus()==="checking"?"checking":this._user()?"authenticated":"not-authenticated");user=u(()=>this._user());token=u(()=>this._token());login(e){return console.log("\u{1F510} AuthService Login - Datos recibidos:",{email:e.email,password:e.password,emailLength:e.email?.length,passwordLength:e.password?.length,apiUrl:`${n}/login`}),this._http.post(`${n}/login`,e).pipe(s(t=>(console.log("\u2705 AuthService Login - Respuesta exitosa:",{id:t.id,email:t.email,role:t.role,hasToken:!!t.token,tokenLength:t.token?.length}),this.handleAuthSuccess(t))),o(t=>{let r=t??{};return console.error("\u274C AuthService Login - Error:",{status:r.status,statusText:r.statusText,message:r.message,url:r.url,data:r.error}),this.handleAuthError(t)}))}register(e){return this._http.post(`${n}/register`,e).pipe(s(t=>this.handleAuthSuccess(t)),o(t=>this.handleAuthError(t)))}updateProfile(e){return this._http.post(`${n}/update-profile`,e).pipe(s(t=>this.handleAuthSuccess(t)),o(t=>this.handleAuthError(t)))}checkAuthStatus(){let e=localStorage.getItem("token");return e?this._http.post(`${n}/check-token`,{},{headers:{Authorization:`Bearer ${e}`}}).pipe(s(t=>this.handleAuthSuccess(t)),o(t=>this.handleAuthError(t))):(this._authStatus.set("not-authenticated"),h(!1))}logout(){this._user.set(null),this._token.set(null),this._authStatus.set("not-authenticated"),localStorage.removeItem("token")}handleAuthSuccess(e){let t=c(l({},e),{role_id:e.role_id??e.role?.id});return this._user.set(t),this._token.set(e.token??null),this._authStatus.set("authenticated"),e.token?localStorage.setItem("token",e.token):localStorage.removeItem("token"),!0}handleAuthError(e){return console.error("AuthService Error:",e),this.logout(),h(!1)}static \u0275fac=function(t){return new(t||a)};static \u0275prov=p({token:a,factory:a.\u0275fac,providedIn:"root"})};export{S as a};
