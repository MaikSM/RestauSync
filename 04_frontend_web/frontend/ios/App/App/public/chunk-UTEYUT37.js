import{a as V}from"./chunk-FEWWBC6R.js";import{a as J}from"./chunk-ZA56YX54.js";import{a as B}from"./chunk-KHIHIFVV.js";import{a as G,b as L,c as O}from"./chunk-CCYSTRO3.js";import{a as E}from"./chunk-DLFABNFZ.js";import"./chunk-YKSGIHVP.js";import"./chunk-IJHKA2LB.js";import{l as U,m as N}from"./chunk-IBNRR53B.js";import{$a as _,Gb as Y,Ib as $,Ja as H,Oa as v,R as y,Ua as p,Xa as R,Ya as h,_a as P,ab as f,bb as a,cb as n,db as b,g as I,kb as x,lb as u,ma as g,o as M,ub as s,vb as d,wb as C,xa as o,xb as F,yb as k}from"./chunk-GQXGSY3T.js";import{a as w,b as T}from"./chunk-YEWEO3AL.js";var z=(r,t)=>t.id,Q=(r,t)=>t.value;function W(r,t){if(r&1&&(a(0,"option",9),s(1),n()),r&2){let e=t.$implicit,i=u();p("value",e.id),o(),k(" ",e.name," ",e.surname," - ",i.getRolDisplay(e.rol)," ")}}function X(r,t){if(r&1&&(a(0,"option",9),s(1),n()),r&2){let e=t.$implicit;p("value",e),o(),d(e)}}function Z(r,t){if(r&1&&(a(0,"option",9),s(1),n()),r&2){let e=t.$implicit;p("value",e.value),o(),d(e.name)}}function q(r,t){if(r&1&&(a(0,"div",13)(1,"div",18)(2,"div",19),s(3),n(),a(4,"div",20),s(5,"Total Empleados"),n()(),a(6,"div",18)(7,"div",21),s(8),n(),a(9,"div",20),s(10,"Presentes"),n()(),a(11,"div",18)(12,"div",22),s(13),n(),a(14,"div",20),s(15,"Ausentes"),n()(),a(16,"div",18)(17,"div",23),s(18),n(),a(19,"div",20),s(20,"Retrasos"),n()(),a(21,"div",18)(22,"div",24),s(23),n(),a(24,"div",20),s(25,"Salidas Tempranas"),n()(),a(26,"div",18)(27,"div",25),s(28),n(),a(29,"div",20),s(30,"Total Registros"),n()()()),r&2){let e=u();o(3),d(e.getEstadisticasGenerales().totalEmpleados),o(5),d(e.getEstadisticasGenerales().presentes),o(5),d(e.getEstadisticasGenerales().ausentes),o(5),d(e.getEstadisticasGenerales().retrasos),o(5),d(e.getEstadisticasGenerales().salidasTempranas),o(5),d(e.getEstadisticasGenerales().totalAsistencias)}}function ee(r,t){r&1&&b(0,"is-loading")}function te(r,t){if(r&1&&(a(0,"span",34),s(1),n()),r&2){let e=u().$implicit;o(),d(e.hora_entrada)}}function ie(r,t){r&1&&(a(0,"span",35),s(1,"-"),n())}function ne(r,t){if(r&1&&(a(0,"span",36),s(1),n()),r&2){let e=u().$implicit;o(),d(e.hora_salida)}}function ae(r,t){r&1&&(a(0,"span",35),s(1,"-"),n())}function re(r,t){if(r&1&&(a(0,"tr",30)(1,"td",31),s(2),Y(3,"date"),n(),a(4,"td",32),s(5),n(),a(6,"td",33),s(7),n(),a(8,"td",32),v(9,te,2,1,"span",34)(10,ie,2,0,"span",35),n(),a(11,"td",32),v(12,ne,2,1,"span",36)(13,ae,2,0,"span",35),n(),a(14,"td",37)(15,"span",38),s(16),n()()()),r&2){let e=t.$implicit,i=u(2);o(2),C(" ",$(3,9,e.fecha,"dd/MM/yyyy")," "),o(3),F(" ",e.user==null?null:e.user.name," ",e.user==null?null:e.user.surname," "),o(2),C(" ",i.getRolDisplay((e.user==null||e.user.role==null?null:e.user.role.name)||"Sin rol")," "),o(2),h(e.hora_entrada?9:10),o(3),h(e.hora_salida?12:13),o(3),R(i.getEstadoColor(e.estado)+" text-white"),o(),C(" ",i.getEstadoAsistencia(e.estado)," ")}}function se(r,t){if(r&1&&(a(0,"div",17)(1,"table",26)(2,"thead",27)(3,"tr")(4,"th",28),s(5,"Fecha"),n(),a(6,"th",28),s(7,"Empleado"),n(),a(8,"th",28),s(9,"Rol"),n(),a(10,"th",28),s(11,"Hora Entrada"),n(),a(12,"th",28),s(13,"Hora Salida"),n(),a(14,"th",28),s(15,"Estado"),n()()(),a(16,"tbody",29),_(17,re,17,12,"tr",30,z),n()()()),r&2){let e=u();o(17),f(e.getAsistenciasFiltradas())}}function oe(r,t){r&1&&b(0,"is-error")}function le(r,t){r&1&&b(0,"is-empty")}var j=class r{_usersService=y(J);_rolesService=y(B);_asistenciaService=y(V);reloadTrigger$=new I(0);selectedUserId=g(null);selectedYear=g(new Date().getFullYear());selectedMonth=g(new Date().getMonth()+1);calendarDays=g([]);currentMonthName=g("");usersResource=E({request:()=>this.reloadTrigger$.value,loader:()=>this._usersService.getAll()});rolesResource=E({request:()=>this.reloadTrigger$.value,loader:()=>this._rolesService.getAll()});asistenciasResource=E({request:()=>({userId:this.selectedUserId(),year:this.selectedYear(),month:this.selectedMonth(),reload:this.reloadTrigger$.value}),loader:({request:t})=>t.userId?this._asistenciaService.getByUserAndMonth(t.userId,t.year,t.month):this._asistenciaService.getAll().pipe(M(e=>e.filter(i=>new Date(i.fecha).getFullYear()===t.year&&new Date(i.fecha).getMonth()+1===t.month)))});ngOnInit(){this.generateCalendar()}onUserChange(t){let i=t.target.value;this.selectedUserId.set(i?parseInt(i):null)}onYearChange(t){let i=t.target.value;this.selectedYear.set(parseInt(i)),this.generateCalendar()}onMonthChange(t){let i=t.target.value;this.selectedMonth.set(parseInt(i)),this.generateCalendar()}generateCalendar(){let t=this.selectedYear(),e=this.selectedMonth()-1,i=new Date(t,e,1),m=new Date(t,e+1,0),l=new Date(i);l.setDate(l.getDate()-i.getDay());let S=[],c=new Date(l);for(let A=0;A<42;A++){let D={date:new Date(c),dayNumber:c.getDate(),isCurrentMonth:c.getMonth()===e,isToday:this.isToday(c),asistencias:[]};this.asistenciasResource.value()&&(D.asistencias=this.asistenciasResource.value().filter(K=>new Date(K.fecha).toDateString()===c.toDateString())),S.push(D),c.setDate(c.getDate()+1)}this.calendarDays.set(S),this.currentMonthName.set(this.getMonthName(e))}isToday(t){let e=new Date;return t.toDateString()===e.toDateString()}getMonthName(t){return["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][t]}getEstadoAsistencia(t){switch(t){case"presente":return"Presente";case"ausente":return"Ausente";case"sin_registro":return"Sin registro";case"ingreso_tarde":return"Ingreso Tarde";case"salida_temprana":return"Salida Temprana";default:return"Desconocido"}}getEstadoColor(t){switch(t){case"presente":return"bg-green-500";case"ausente":return"bg-red-500";case"sin_registro":return"bg-gray-400";case"ingreso_tarde":return"bg-yellow-500";case"salida_temprana":return"bg-orange-500";default:return"bg-gray-400"}}getRolDisplay(t){switch(t.toLowerCase()){case"admin":return"Administrador";case"waiter":return"Mesero";case"user":return"Cliente";default:return t}}getYears(){let t=new Date().getFullYear(),e=[];for(let i=t-2;i<=t+1;i++)e.push(i);return e}getMonths(){return[{value:1,name:"Enero"},{value:2,name:"Febrero"},{value:3,name:"Marzo"},{value:4,name:"Abril"},{value:5,name:"Mayo"},{value:6,name:"Junio"},{value:7,name:"Julio"},{value:8,name:"Agosto"},{value:9,name:"Septiembre"},{value:10,name:"Octubre"},{value:11,name:"Noviembre"},{value:12,name:"Diciembre"}]}getEmpleadosFiltrados(){let t=this.usersResource.value()||[],e=this.rolesResource.value()||[];return t.filter(i=>{let m=e.find(l=>l.id===i.role_id);return m&&m.name.toLowerCase()!=="user"}).map(i=>{let m=e.find(l=>l.id===i.role_id);return T(w({},i),{rol:m?.name||"Sin rol"})})}getAsistenciasFiltradas(){return this.asistenciasResource.value()?this.selectedUserId()?this.asistenciasResource.value():this.asistenciasResource.value():[]}getEstadisticasGenerales(){let t=this.getAsistenciasFiltradas();return{totalEmpleados:this.getEmpleadosFiltrados().length,totalAsistencias:t.length,presentes:t.filter(i=>i.estado==="presente").length,ausentes:t.filter(i=>i.estado==="ausente").length,retrasos:t.filter(i=>i.estado==="ingreso_tarde").length,salidasTempranas:t.filter(i=>i.estado==="salida_temprana").length}}goBack(){window.history.back()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=H({type:r,selectors:[["admin-asistencia-historial-page"]],decls:40,vars:4,consts:[[1,"bg-gray-900","text-gray-100","min-h-screen","p-4","sm:p-6","overflow-x-hidden"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","gap-3","border-b-2","border-orange-500","p-4","bg-gray-800","shadow-md","mb-6","rounded-lg"],[1,"text-center","sm:text-left","text-2xl","sm:text-3xl","font-bold","text-white"],[1,"btn","btn-sm","sm:btn-md","bg-gray-600","hover:bg-gray-700","text-white",3,"click"],[1,"bg-gray-800","rounded-lg","p-4","mb-6"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[1,"block","text-sm","font-medium","text-gray-300","mb-2"],[1,"w-full","px-3","py-2","bg-gray-700","border","border-gray-600","rounded-md","text-gray-100","focus:outline-none","focus:ring-2","focus:ring-orange-500",3,"change"],["value",""],[3,"value"],[1,"w-full","px-3","py-2","bg-gray-700","border","border-gray-600","rounded-md","text-gray-100","focus:outline-none","focus:ring-2","focus:ring-orange-500",3,"change","value"],[1,"flex","items-end"],[1,"w-full","px-4","py-2","bg-orange-500","hover:bg-orange-600","text-white","rounded-md","font-medium","transition",3,"click"],[1,"grid","grid-cols-2","md:grid-cols-6","gap-4","mb-6"],[1,"bg-gray-800","rounded-lg","overflow-hidden"],[1,"p-4","border-b","border-gray-700"],[1,"text-xl","font-semibold","text-orange-400"],[1,"overflow-x-auto"],[1,"bg-gray-800","rounded-lg","p-4","text-center"],[1,"text-2xl","font-bold","text-blue-400"],[1,"text-gray-300","text-sm"],[1,"text-2xl","font-bold","text-green-400"],[1,"text-2xl","font-bold","text-red-400"],[1,"text-2xl","font-bold","text-yellow-400"],[1,"text-2xl","font-bold","text-orange-400"],[1,"text-2xl","font-bold","text-purple-400"],[1,"w-full"],[1,"bg-orange-500/10"],[1,"px-4","py-3","text-left","text-xs","font-medium","text-orange-400","uppercase","tracking-wider"],[1,"divide-y","divide-gray-600"],[1,"hover:bg-gray-700","transition-colors"],[1,"px-4","py-3","text-sm","text-white","font-medium"],[1,"px-4","py-3","text-sm","text-white"],[1,"px-4","py-3","text-sm","text-gray-300"],[1,"text-green-400"],[1,"text-gray-500"],[1,"text-blue-400"],[1,"px-4","py-3","text-sm"],[1,"px-2","py-1","rounded-full","text-xs","font-medium"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"h1",2),s(3," \u{1F4CA} Historial Completo de Asistencia "),n(),a(4,"button",3),x("click",function(){return i.goBack()}),s(5," \u2190 Volver "),n()(),a(6,"div",4)(7,"div",5)(8,"div")(9,"label",6),s(10,"Empleado"),n(),a(11,"select",7),x("change",function(l){return i.onUserChange(l)}),a(12,"option",8),s(13,"Todos los empleados"),n(),_(14,W,2,4,"option",9,z),n()(),a(16,"div")(17,"label",6),s(18,"A\xF1o"),n(),a(19,"select",10),x("change",function(l){return i.onYearChange(l)}),_(20,X,2,2,"option",9,P),n()(),a(22,"div")(23,"label",6),s(24,"Mes"),n(),a(25,"select",10),x("change",function(l){return i.onMonthChange(l)}),_(26,Z,2,2,"option",9,Q),n()(),a(28,"div",11)(29,"button",12),x("click",function(){return i.generateCalendar()}),s(30," \u{1F504} Actualizar "),n()()()(),v(31,q,31,6,"div",13),a(32,"div",14)(33,"div",15)(34,"h2",16),s(35," \u{1F4CB} Detalle de Asistencias "),n()(),v(36,ee,1,0,"is-loading")(37,se,19,0,"div",17)(38,oe,1,0,"is-error")(39,le,1,0,"is-empty"),n()()),e&2&&(o(14),f(i.getEmpleadosFiltrados()),o(5),p("value",i.selectedYear()),o(),f(i.getYears()),o(5),p("value",i.selectedMonth()),o(),f(i.getMonths()),o(5),h(i.usersResource.hasValue()&&i.rolesResource.hasValue()?31:-1),o(5),h(i.asistenciasResource.isLoading()?36:i.asistenciasResource.hasValue()?37:i.asistenciasResource.error()?38:39))},dependencies:[N,U,G,L,O],encapsulation:2,changeDetection:0})};export{j as AdminAsistenciaHistorialPageComponent};
