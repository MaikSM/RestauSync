import{a as l}from"./chunk-YKSGIHVP.js";import{a as b}from"./chunk-IJHKA2LB.js";import{I as o,L as u,R as h,f as p,o as d,w as s}from"./chunk-GQXGSY3T.js";var n=`${l.apiUrl}/mesas`,i=`${l.apiUrl}/reservas`,v=class c{_http=h(b);reloadSubject=new p;reload$=this.reloadSubject.asObservable();notifyReload(){this.reloadSubject.next()}getMesas(){return this._http.get(`${n}`,{headers:{"Cache-Control":"no-cache"}}).pipe(d(e=>{console.log("\u{1F4CB} Servicio: Datos de mesas del backend:",e),console.log("\u{1F50D} Primera mesa:",e[0]);let a=e.map(t=>({id:t.mesa_id,numero:t.numero,capacidad:t.capacidad,estado:t.estado,ubicacion:t.ubicacion,created_at:t.created_at,updated_at:t.updated_at,deleted_at:t.deleted_at}));return console.log("\u2705 Servicio: Mesas mapeadas:",a),a}),s(e=>{throw console.error("\u274C Servicio: Error al obtener mesas:",e),e}))}getMesaById(e){return this._http.get(`${n}/${e}`)}createMesa(e){return this._http.post(`${n}`,e).pipe(o(a=>a),o(()=>this.notifyReload()),s(a=>{throw console.error("Error creating mesa:",a),a}))}updateMesa(e,a){return this._http.patch(`${n}/${e}`,a).pipe(o(t=>t),o(()=>this.notifyReload()),s(t=>{throw console.error("Error updating mesa:",t),t}))}deleteMesa(e){return this._http.delete(`${n}/${e}`).pipe(o(()=>this.notifyReload()))}cambiarEstadoMesa(e,a){return this._http.patch(`${n}/${e}/estado`,{estado:a}).pipe(o(t=>t),o(()=>this.notifyReload()),s(t=>{throw console.error("Error changing mesa status:",t),t}))}getReservas(){return console.log("\u{1F504} Servicio: Solicitando reservas desde",i),this._http.get(`${i}`,{headers:{"Cache-Control":"no-cache"}}).pipe(o(e=>{console.log("\u2705 Servicio: Respuesta del backend:",e)}),d(e=>{let a=[];Array.isArray(e)?(a=e,console.log("\u2705 Servicio: La respuesta es un array con",a.length,"reservas")):e&&typeof e=="object"?(a=e.data||e.reservas||[],console.log("\u2705 Servicio: La respuesta es un objeto, extrayendo array de data:",a.length,"reservas")):(console.warn("\u26A0\uFE0F Servicio: Respuesta inesperada:",e),a=[]),console.log("\u{1F4CB} Servicio: Datos de reservas:",a),console.log("\u{1F50D} Primera reserva:",a[0]);let t=a.map(r=>({reserva_id:r.reserva_id,mesa_id:r.mesa_id,cliente_nombre:r.cliente_nombre,cliente_email:r.cliente_email,cliente_telefono:r.cliente_telefono,fecha_hora:new Date(r.fecha_hora),numero_personas:r.numero_personas,estado:r.estado,notas:r.notas,created_at:new Date(r.created_at),updated_at:new Date(r.updated_at),deleted_at:r.deleted_at?new Date(r.deleted_at):void 0,mesa:r.mesa?{id:r.mesa.mesa_id,numero:r.mesa.numero,capacidad:r.mesa.capacidad,estado:r.mesa.estado,ubicacion:r.mesa.ubicacion,created_at:r.mesa.created_at,updated_at:r.mesa.updated_at,deleted_at:r.mesa.deleted_at}:void 0}));return console.log("\u2705 Servicio: Reservas mapeadas:",t),t}),s(e=>{throw console.error("\u274C Servicio: Error al obtener reservas:",e),e}))}getReservaById(e){return console.log("\u{1F504} Servicio: Solicitando reserva ID:",e),this._http.get(`${i}/${e}`).pipe(o(a=>{console.log("\u{1F4E5} Servicio: Reserva recibida:",a),console.log("\u{1F522} Servicio: mesa_id:",a.mesa_id,typeof a.mesa_id)}),s(a=>{throw console.error("\u274C Servicio: Error al obtener reserva:",a),a}))}getReservasByFecha(e){return this._http.get(`${i}/fecha/${e}`)}getReservasByMesa(e){return this._http.get(`${i}/mesa/${e}`)}createReserva(e){return this._http.post(i,e).pipe(o(a=>a),o(()=>this.notifyReload()),s(a=>{throw console.error("Error creating reserva:",a),a}))}updateReserva(e,a){return this._http.put(`${i}/${e}`,a).pipe(o(t=>t),o(()=>this.notifyReload()),s(t=>{throw console.error("Error updating reserva:",t),t}))}deleteReserva(e){return this._http.delete(`${i}/${e}`).pipe(o(()=>this.notifyReload()))}cancelarReserva(e){return this._http.patch(`${i}/${e}/cancelar`,{}).pipe(o(a=>a),o(()=>this.notifyReload()),s(a=>{throw console.error("Error canceling reserva:",a),a}))}static \u0275fac=function(a){return new(a||c)};static \u0275prov=u({token:c,factory:c.\u0275fac,providedIn:"root"})};export{v as a};
