import{a as ee}from"./chunk-X6DMPGQL.js";import{a as H,c as O,d as j,e as q,f as z,g as G,h as U,k as Y,l as J,m as K,n as Q,o as X,p as Z,r as $}from"./chunk-L57FSASQ.js";import"./chunk-YKSGIHVP.js";import{b as L,d as B}from"./chunk-BBMTBTDA.js";import"./chunk-IJHKA2LB.js";import{j as T,k as W,m as N}from"./chunk-IBNRR53B.js";import{$a as F,Ab as p,Bb as _,Gb as I,Hb as k,Ja as A,Nb as D,Oa as h,R as f,Ua as v,Ya as y,Z as c,_ as g,ab as P,bb as t,cb as i,db as E,hb as M,kb as x,lb as m,tb as V,ub as n,wb as b,xa as d,xb as C,zb as u}from"./chunk-GQXGSY3T.js";import{a as w,b as R}from"./chunk-YEWEO3AL.js";var te=(s,o)=>o.id+"_"+o.numero;function ae(s,o){s&1&&(t(0,"div",10),E(1,"span",11),t(2,"span",12),n(3,"Cargando reserva..."),i()())}function re(s,o){if(s&1&&(t(0,"div",13),n(1),i()),s&2){let a=m();d(),b(" \u26A0\uFE0F ",a.errorMessage," ")}}function ie(s,o){if(s&1&&(t(0,"option",26),n(1),i()),s&2){let a=o.$implicit,e=m(2);v("value",a.id)("selected",e.reserva.mesa_id===a.id),d(),C(" Mesa ",a.numero," (Capacidad: ",a.capacidad,") ")}}function ne(s,o){if(s&1&&(t(0,"p"),n(1),i()),s&2){let a=m(3);d(),b("Ubicaci\xF3n: ",a.mesaActual.ubicacion,"")}}function oe(s,o){if(s&1&&(t(0,"div",37),n(1," \u2139\uFE0F "),t(2,"div")(3,"h4",41),n(4),i(),t(5,"p"),n(6),I(7,"titlecase"),i(),h(8,ne,2,1,"p"),i()()),s&2){let a=m(2);d(4),b(" Mesa Actual: ",a.mesaActual.numero," "),d(2),C(" Capacidad: ",a.mesaActual.capacidad," personas | Estado: ",k(7,4,a.mesaActual.estado)," "),d(2),y(a.mesaActual.ubicacion?8:-1)}}function se(s,o){s&1&&(E(0,"span",42),n(1," Guardando... "))}function de(s,o){s&1&&n(0," \u{1F4BE} Guardar Cambios ")}function le(s,o){if(s&1){let a=M();t(0,"div",14)(1,"div",15)(2,"form",16,0),x("ngSubmit",function(){c(a);let r=m();return g(r.guardarReserva())}),t(4,"div",17)(5,"div",18)(6,"h3",19),n(7," \u{1F464} Informaci\xF3n del Cliente "),i(),t(8,"div")(9,"label",20),n(10," Nombre del Cliente * "),i(),t(11,"input",21),_("ngModelChange",function(r){c(a);let l=m();return p(l.reserva.cliente_nombre,r)||(l.reserva.cliente_nombre=r),g(r)}),i()(),t(12,"div")(13,"label",20),n(14," Email "),i(),t(15,"input",22),_("ngModelChange",function(r){c(a);let l=m();return p(l.reserva.cliente_email,r)||(l.reserva.cliente_email=r),g(r)}),i()(),t(16,"div")(17,"label",20),n(18," Tel\xE9fono "),i(),t(19,"input",23),_("ngModelChange",function(r){c(a);let l=m();return p(l.reserva.cliente_telefono,r)||(l.reserva.cliente_telefono=r),g(r)}),i()()(),t(20,"div",18)(21,"h3",19),n(22," \u{1F4C5} Detalles de la Reserva "),i(),t(23,"div")(24,"label",20),n(25," Mesa * "),i(),t(26,"select",24),_("ngModelChange",function(r){c(a);let l=m();return p(l.reserva.mesa_id,r)||(l.reserva.mesa_id=r),g(r)}),t(27,"option",25),n(28,"Seleccionar mesa"),i(),F(29,ie,2,4,"option",26,te),i(),t(31,"div",27),n(32),i()(),t(33,"div")(34,"label",20),n(35," Fecha y Hora * "),i(),t(36,"input",28),_("ngModelChange",function(r){c(a);let l=m();return p(l.fechaHoraFormateada,r)||(l.fechaHoraFormateada=r),g(r)}),i()(),t(37,"div")(38,"label",20),n(39," N\xFAmero de Personas * "),i(),t(40,"input",29),_("ngModelChange",function(r){c(a);let l=m();return p(l.reserva.numero_personas,r)||(l.reserva.numero_personas=r),g(r)}),i()(),t(41,"div")(42,"label",20),n(43," Estado "),i(),t(44,"select",30),_("ngModelChange",function(r){c(a);let l=m();return p(l.reserva.estado,r)||(l.reserva.estado=r),g(r)}),t(45,"option",31),n(46,"Pendiente"),i(),t(47,"option",32),n(48,"Confirmado"),i(),t(49,"option",33),n(50,"Cancelada"),i(),t(51,"option",34),n(52,"Completada"),i()()()()(),t(53,"div",35)(54,"label",20),n(55," Notas "),i(),t(56,"textarea",36),_("ngModelChange",function(r){c(a);let l=m();return p(l.reserva.notas,r)||(l.reserva.notas=r),g(r)}),i()(),h(57,oe,9,6,"div",37),t(58,"div",38)(59,"button",39),x("click",function(){c(a);let r=m();return g(r._router.navigate(["/admin/reservas-mesas"]))}),n(60," \u274C Cancelar "),i(),t(61,"button",40),h(62,se,2,0)(63,de,1,0),i()()()()()}if(s&2){let a=V(3),e=m();d(11),u("ngModel",e.reserva.cliente_nombre),d(4),u("ngModel",e.reserva.cliente_email),d(4),u("ngModel",e.reserva.cliente_telefono),d(7),u("ngModel",e.reserva.mesa_id),d(3),P(e.mesas),d(3),C(" Valor actual: ",e.reserva.mesa_id," (",e.reserva.mesa_id?"n\xFAmero":"vac\xEDo",") "),d(4),u("ngModel",e.fechaHoraFormateada),d(4),u("ngModel",e.reserva.numero_personas),d(4),u("ngModel",e.reserva.estado),d(12),u("ngModel",e.reserva.notas),d(),y(e.mesaActual?57:-1),d(4),v("disabled",a.invalid||e.isSaving),d(),y(e.isSaving?62:63)}}function me(s,o){if(s&1){let a=M();t(0,"div",43)(1,"div",44),n(2,"\u{1F4C5}"),i(),t(3,"h3",45),n(4,"Reserva no encontrada"),i(),t(5,"p",46),n(6," La reserva que buscas no existe o ha sido eliminada. "),i(),t(7,"button",47),x("click",function(){c(a);let r=m();return g(r._router.navigate(["/admin/reservas-mesas"]))}),n(8," \u2B05\uFE0F Volver a Reservas "),i()()}}var S=class s{_router=f(B);_route=f(L);_reservasService=f(ee);_cdr=f(D);reserva=null;mesas=[];mesaActual=null;isLoading=!1;isSaving=!1;errorMessage="";_fechaHoraFormateada="";get fechaHoraFormateada(){return this._fechaHoraFormateada}set fechaHoraFormateada(o){this._fechaHoraFormateada=o,o&&this.reserva&&(this.reserva.fecha_hora=new Date(o+":00"))}ngOnInit(){console.log("\u{1F680} AdminReservasEditPageComponent: Inicializando..."),console.log("\u{1F50D} ngOnInit ejecut\xE1ndose..."),this.loadMesas(),this.loadReserva()}loadMesas(){this._reservasService.getMesas().subscribe({next:o=>{this.mesas=o,this._cdr.markForCheck(),console.log("\u2705 Mesas cargadas:",o.length)},error:o=>{console.error("\u274C Error cargando mesas:",o),this.errorMessage="Error al cargar las mesas disponibles",this._cdr.markForCheck()}})}loadReserva(){let o=this._route.snapshot.paramMap.get("id");if(!o){this.errorMessage="ID de reserva no proporcionado",this._cdr.markForCheck();return}let a=parseInt(o,10);if(isNaN(a)){this.errorMessage="ID de reserva inv\xE1lido",this._cdr.markForCheck();return}this.isLoading=!0,this.errorMessage="",this._reservasService.getReservaById(a).subscribe({next:e=>{if(console.log("\u{1F4E5} Reserva recibida del backend:",e),console.log("\u{1F522} mesa_id original:",e.mesa_id,typeof e.mesa_id),this.reserva=R(w({},e),{reserva_id:a,mesa_id:e.mesa_id}),console.log("\u{1F4E4} Reserva asignada al componente:",this.reserva),console.log("\u{1F522} mesa_id asignado:",this.reserva.mesa_id,typeof this.reserva.mesa_id),this.mesaActual=e.mesa||null,e.fecha_hora){let r=new Date(e.fecha_hora);this._fechaHoraFormateada=r.toISOString().slice(0,16),console.log("\u{1F4C5} Fecha formateada:",this._fechaHoraFormateada)}this.isLoading=!1,this._cdr.markForCheck(),console.log("\u2705 Reserva cargada completamente")},error:e=>{this.isLoading=!1,this._cdr.markForCheck(),e.status===404?this.errorMessage="La reserva no fue encontrada":e.status===401?this.errorMessage="No tienes permisos para ver esta reserva":this.errorMessage=`Error al cargar la reserva: ${e.message||"Error desconocido"}`,console.error("\u274C Error cargando reserva:",e)}})}guardarReserva(){if(!this.reserva){this.errorMessage="No hay datos de reserva para guardar";return}if(!this.reserva.cliente_nombre?.trim()){this.errorMessage="El nombre del cliente es obligatorio";return}if(!this.reserva.mesa_id){this.errorMessage="Debe seleccionar una mesa v\xE1lida";return}let o=typeof this.reserva.mesa_id=="string"?parseInt(this.reserva.mesa_id,10):Number(this.reserva.mesa_id);if(isNaN(o)||o<=0){this.errorMessage="ID de mesa inv\xE1lido";return}if(!this.reserva.numero_personas||this.reserva.numero_personas<=0){this.errorMessage="El n\xFAmero de personas debe ser mayor a 0";return}if(!this._fechaHoraFormateada){this.errorMessage="La fecha y hora son obligatorias";return}this.isSaving=!0,this.errorMessage="";let a={cliente_nombre:this.reserva.cliente_nombre.trim(),cliente_email:this.reserva.cliente_email?.trim()||void 0,cliente_telefono:this.reserva.cliente_telefono?.trim()||void 0,mesa_id:o,fecha_hora:this.reserva.fecha_hora?.toISOString(),numero_personas:this.reserva.numero_personas,estado:this.reserva.estado||"pendiente",notas:this.reserva.notas?.trim()||void 0};console.log("\u{1F4E4} Enviando datos de actualizaci\xF3n:",a),console.log("\u{1F522} mesa_id tipo:",typeof o,"valor:",o),this._reservasService.updateReserva(this.reserva.reserva_id,a).subscribe({next:e=>{this.isSaving=!1,this._cdr.markForCheck(),console.log("\u2705 Reserva actualizada:",e),alert("Reserva actualizada correctamente"),this._router.navigate(["/admin/reservas-mesas"])},error:e=>{this.isSaving=!1,this._cdr.markForCheck(),e.status===400?this.errorMessage="Los datos proporcionados no son v\xE1lidos":e.status===404?this.errorMessage="La reserva no fue encontrada":e.status===409?this.errorMessage="Ya existe una reserva para esa mesa en esa fecha y hora":this.errorMessage=`Error al actualizar la reserva: ${e.message||"Error desconocido"}`,console.error("\u274C Error actualizando reserva:",e)}})}cancelar(){confirm("\xBFEst\xE1 seguro de que desea cancelar? Los cambios no guardados se perder\xE1n.")&&this._router.navigate(["/admin/reservas-mesas"])}static \u0275fac=function(a){return new(a||s)};static \u0275cmp=A({type:s,selectors:[["app-admin-reservas-edit-page"]],decls:11,vars:4,consts:[["reservaForm","ngForm"],[1,"bg-gray-900","text-gray-100","min-h-screen","p-6"],[1,"flex","justify-between","items-center","mb-6"],[1,"flex","items-center","gap-4"],[1,"btn","bg-gray-700","hover:bg-gray-600","text-gray-300",3,"click"],[1,"text-3xl","font-bold","text-orange-500"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","bg-red-600 text-white p-4 rounded-lg mb-6",4,"ngIf"],["class","bg-gray-800 rounded-xl shadow-lg border border-gray-700",4,"ngIf"],["class","text-center py-12",4,"ngIf"],[1,"flex","justify-center","items-center","py-8"],[1,"loading","loading-spinner","loading-lg","text-orange-500"],[1,"ml-2","text-gray-300"],[1,"bg-red-600","text-white","p-4","rounded-lg","mb-6"],[1,"bg-gray-800","rounded-xl","shadow-lg","border","border-gray-700"],[1,"p-6"],[1,"space-y-6",3,"ngSubmit"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"space-y-4"],[1,"text-lg","font-semibold","text-orange-400","mb-4"],[1,"block","text-sm","font-bold","text-orange-400","mb-2"],["type","text","name","cliente_nombre","required","","placeholder","Ingrese el nombre del cliente",1,"w-full","px-3","py-2","bg-gray-700","border","border-gray-600","rounded-md","text-gray-100","placeholder-gray-400","focus:outline-none","focus:ring-2","focus:ring-orange-500",3,"ngModelChange","ngModel"],["type","email","name","cliente_email","placeholder","cliente@ejemplo.com",1,"w-full","px-3","py-2","bg-gray-700","border","border-gray-600","rounded-md","text-gray-100","placeholder-gray-400","focus:outline-none","focus:ring-2","focus:ring-orange-500",3,"ngModelChange","ngModel"],["type","tel","name","cliente_telefono","placeholder","+57 300 123 4567",1,"w-full","px-3","py-2","bg-gray-700","border","border-gray-600","rounded-md","text-gray-100","placeholder-gray-400","focus:outline-none","focus:ring-2","focus:ring-orange-500",3,"ngModelChange","ngModel"],["name","mesa_id","required","",1,"w-full","px-3","py-2","bg-gray-700","border","border-gray-600","rounded-md","text-gray-100","focus:outline-none","focus:ring-2","focus:ring-orange-500",3,"ngModelChange","ngModel"],["value",""],[3,"value","selected"],[1,"text-xs","text-gray-400","mt-1"],["type","datetime-local","name","fecha_hora","required","",1,"w-full","px-3","py-2","bg-gray-700","border","border-gray-600","rounded-md","text-gray-100","focus:outline-none","focus:ring-2","focus:ring-orange-500",3,"ngModelChange","ngModel"],["type","number","name","numero_personas","min","1","max","20","required","",1,"w-full","px-3","py-2","bg-gray-700","border","border-gray-600","rounded-md","text-gray-100","focus:outline-none","focus:ring-2","focus:ring-orange-500",3,"ngModelChange","ngModel"],["name","estado",1,"w-full","px-3","py-2","bg-gray-700","border","border-gray-600","rounded-md","text-gray-100","focus:outline-none","focus:ring-2","focus:ring-orange-500",3,"ngModelChange","ngModel"],["value","pendiente"],["value","confirmado"],["value","cancelada"],["value","completada"],[1,"mt-6"],["rows","3","name","notas","placeholder","Notas adicionales sobre la reserva...",1,"w-full","px-3","py-2","bg-gray-700","border","border-gray-600","rounded-md","text-gray-100","placeholder-gray-400","focus:outline-none","focus:ring-2","focus:ring-orange-500",3,"ngModelChange","ngModel"],[1,"bg-blue-600","text-white","p-4","rounded-lg","mt-6"],[1,"flex","justify-end","gap-4","mt-8"],["type","button",1,"btn","bg-gray-600","hover:bg-gray-700","text-white",3,"click"],["type","submit",1,"btn","bg-orange-500","hover:bg-orange-600","text-white","disabled:opacity-50",3,"disabled"],[1,"font-semibold"],[1,"loading","loading-spinner","loading-sm"],[1,"text-center","py-12"],[1,"text-6xl","text-gray-400","mb-4"],[1,"text-xl","font-semibold","mb-2","text-gray-300"],[1,"text-gray-400","mb-4"],[1,"btn","bg-orange-500","hover:bg-orange-600","text-white",3,"click"]],template:function(a,e){a&1&&(t(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),x("click",function(){return e._router.navigate(["/admin/reservas-mesas"])}),n(4," \u2B05\uFE0F Volver "),i(),t(5,"h1",5),n(6,"\u270F\uFE0F Editar Reserva"),i()()(),h(7,ae,4,0,"div",6)(8,re,2,1,"div",7)(9,le,64,13,"div",8)(10,me,9,0,"div",9),i()),a&2&&(d(7),v("ngIf",e.isLoading),d(),v("ngIf",e.errorMessage),d(),v("ngIf",!e.isLoading&&e.reserva),d(),v("ngIf",!e.isLoading&&!e.reserva))},dependencies:[N,T,W,$,G,J,K,H,U,Y,O,j,Z,X,Q,z,q],encapsulation:2,changeDetection:0})},Ee=S;export{S as AdminReservasEditPageComponent,Ee as default};
